import {
  ChipGroup
} from "./chunk-ULPN2T4G.js";
import {
  SplitView
} from "./chunk-EGRUNA7D.js";
import {
  InlineTip
} from "./chunk-M3Z2FM2U.js";
import {
  HandleInput
} from "./chunk-BVXUBSGC.js";
import {
  CSS,
  DndContext,
  DragOverlay,
  KeyboardSensor,
  PointerSensor,
  SortableContext,
  arrayMove,
  defaultDropAnimationSideEffects,
  sortableKeyboardCoordinates,
  useSensor,
  useSensors,
  useSortable
} from "./chunk-YOONQXHA.js";
import {
  useSalesChannelTableColumns
} from "./chunk-TLUJIKG2.js";
import "./chunk-CKRB62SG.js";
import "./chunk-KTHKGBUF.js";
import {
  CategoryCombobox
} from "./chunk-R4EIC7LT.js";
import {
  useComboboxData
} from "./chunk-7TICE4UP.js";
import {
  Combobox
} from "./chunk-EWBNMDEK.js";
import {
  PRODUCT_CREATE_FORM_DEFAULTS,
  ProductCreateSchema,
  UploadMediaFormItem,
  decorateVariantsWithDefaultValues,
  normalizeProductFormValues
} from "./chunk-YZ3ASHCH.js";
import "./chunk-CWUOXUSQ.js";
import {
  DataGrid,
  createDataGridHelper,
  createDataGridPriceColumns
} from "./chunk-IW7WG74X.js";
import "./chunk-55MYIBGD.js";
import {
  ChipInput
} from "./chunk-IB4ANFLT.js";
import "./chunk-4TA2GWZH.js";
import "./chunk-MS77OZQ6.js";
import {
  useSalesChannelTableQuery
} from "./chunk-QOLDQVU6.js";
import {
  useSalesChannelTableFilters
} from "./chunk-OCUAOOGJ.js";
import "./chunk-EGRHWZRV.js";
import "./chunk-QZUCBNNJ.js";
import {
  DataTable,
  useDataTable
} from "./chunk-JH6E7Y6M.js";
import "./chunk-EIGZCZHJ.js";
import "./chunk-CEIAMOT7.js";
import "./chunk-EYAVSJ2J.js";
import {
  createColumnHelper
} from "./chunk-TI6Y7EUW.js";
import "./chunk-JEFCFQ36.js";
import "./chunk-Z74QHE3B.js";
import "./chunk-6VC5CKXS.js";
import "./chunk-4HJQONUH.js";
import "./chunk-IANM7SMM.js";
import {
  SwitchBox
} from "./chunk-52JADW6C.js";
import "./chunk-LKYIPMJI.js";
import {
  RouteFocusModal,
  useRouteModal
} from "./chunk-3P6F4Q7W.js";
import "./chunk-2T2WSTEX.js";
import "./chunk-QUYQ44V5.js";
import "./chunk-7PAMQDEU.js";
import "./chunk-O47TKOMU.js";
import {
  Divider
} from "./chunk-LRCLMHMB.js";
import "./chunk-E26TGYVV.js";
import "./chunk-BCDFWL4W.js";
import "./chunk-VOJT3GRC.js";
import "./chunk-4I3TSILH.js";
import "./chunk-P5R3EHIV.js";
import "./chunk-2TBOMIQA.js";
import "./chunk-7VADNSL7.js";
import "./chunk-AJ3DXG4K.js";
import "./chunk-FYV5O3WI.js";
import "./chunk-ENW5Z6NU.js";
import "./chunk-MKU523AN.js";
import "./chunk-EFAG6P6Z.js";
import "./chunk-NJ7HRVAN.js";
import "./chunk-KNWZIBC3.js";
import "./chunk-5RUNMRCW.js";
import "./chunk-CFFZHLR2.js";
import "./chunk-YEEFU7KP.js";
import "./chunk-6MTGJSDM.js";
import "./chunk-Z34GYBFG.js";
import "./chunk-VN2HND4I.js";
import "./chunk-ACJP53PC.js";
import "./chunk-3AX2W3RD.js";
import {
  useStore
} from "./chunk-ICPBA7GK.js";
import {
  useRegions
} from "./chunk-FREJU5EQ.js";
import {
  usePricePreferences
} from "./chunk-4UBJQZN6.js";
import "./chunk-QSXBBOKN.js";
import "./chunk-YSLQHU2M.js";
import {
  ActionMenu
} from "./chunk-IE22HJTV.js";
import "./chunk-RLHQ5IGU.js";
import "./chunk-HZGR4LPF.js";
import "./chunk-3FGSU2DA.js";
import "./chunk-YUBPGLTM.js";
import "./chunk-K4BQKT4B.js";
import "./chunk-SWXOOP7W.js";
import "./chunk-ROURSU5C.js";
import {
  useSalesChannel,
  useSalesChannels
} from "./chunk-ABZDCU5X.js";
import {
  useCreateProduct
} from "./chunk-3VJMO5NN.js";
import "./chunk-IH74SCJ5.js";
import "./chunk-4UMAAWOP.js";
import "./chunk-Y5OEN2X7.js";
import "./chunk-V6QTDRXV.js";
import {
  t
} from "./chunk-NMISSY3S.js";
import "./chunk-D6YTPD33.js";
import {
  Controller,
  Form,
  useFieldArray,
  useForm,
  useWatch
} from "./chunk-TKBVWLOU.js";
import {
  isFetchError
} from "./chunk-LGRZWXKE.js";
import "./chunk-2ZDF4QRQ.js";
import "./chunk-QDFILGGU.js";
import {
  sdk
} from "./chunk-ZSXFNTF6.js";
import {
  Alert,
  Button,
  Checkbox,
  DotsSix,
  Heading,
  Hint,
  IconButton,
  Input,
  Label,
  ProgressTabs,
  StackPerspective,
  Text,
  Textarea,
  ThumbnailBadge,
  Trans,
  Trash,
  XMark,
  XMarkMini,
  clx,
  toast,
  useTranslation
} from "./chunk-ZUPX4YFG.js";
import "./chunk-HTGWU6KF.js";
import "./chunk-64MXM5QD.js";
import "./chunk-3VI6QF3M.js";
import {
  require_jsx_runtime
} from "./chunk-P6CFP5BP.js";
import {
  __toESM,
  require_react
} from "./chunk-H5NG3XTT.js";

// node_modules/@medusajs/dashboard/dist/product-create-ZZF6M52P.mjs
var import_react = __toESM(require_react(), 1);
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_react2 = __toESM(require_react(), 1);
var import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);
var import_react3 = __toESM(require_react(), 1);
var import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime4 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime5 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime6 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime7 = __toESM(require_jsx_runtime(), 1);
var import_react4 = __toESM(require_react(), 1);
var import_react5 = __toESM(require_react(), 1);
var import_react6 = __toESM(require_react(), 1);
var import_jsx_runtime8 = __toESM(require_jsx_runtime(), 1);
var import_react7 = __toESM(require_react(), 1);
var import_jsx_runtime9 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime10 = __toESM(require_jsx_runtime(), 1);
var import_react8 = __toESM(require_react(), 1);
var import_jsx_runtime11 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime12 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime13 = __toESM(require_jsx_runtime(), 1);
var ProductCreateGeneralSection = ({
  form
}) => {
  const { t: t2 } = useTranslation();
  return (0, import_jsx_runtime.jsxs)("div", { id: "general", className: "flex flex-col gap-y-6", children: [
    (0, import_jsx_runtime.jsx)("div", { className: "flex flex-col gap-y-2", children: (0, import_jsx_runtime.jsxs)("div", { className: "grid grid-cols-1 gap-4 md:grid-cols-3", children: [
      (0, import_jsx_runtime.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "title",
          render: ({ field }) => {
            return (0, import_jsx_runtime.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime.jsx)(Form.Label, { children: t2("products.fields.title.label") }),
              (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(Input, { ...field, placeholder: "Winter jacket" }) })
            ] });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "subtitle",
          render: ({ field }) => {
            return (0, import_jsx_runtime.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime.jsx)(Form.Label, { optional: true, children: t2("products.fields.subtitle.label") }),
              (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(Input, { ...field, placeholder: "Warm and cosy" }) })
            ] });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "handle",
          render: ({ field }) => {
            return (0, import_jsx_runtime.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime.jsx)(
                Form.Label,
                {
                  tooltip: t2("products.fields.handle.tooltip"),
                  optional: true,
                  children: t2("fields.handle")
                }
              ),
              (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(HandleInput, { ...field, placeholder: "winter-jacket" }) })
            ] });
          }
        }
      )
    ] }) }),
    (0, import_jsx_runtime.jsx)(
      Form.Field,
      {
        control: form.control,
        name: "description",
        render: ({ field }) => {
          return (0, import_jsx_runtime.jsxs)(Form.Item, { children: [
            (0, import_jsx_runtime.jsx)(Form.Label, { optional: true, children: t2("products.fields.description.label") }),
            (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(Textarea, { ...field, placeholder: "A warm and cozy jacket" }) })
          ] });
        }
      }
    )
  ] });
};
var ProductCreateMediaSection = ({
  form
}) => {
  const { fields, append, remove } = useFieldArray({
    name: "media",
    control: form.control,
    keyName: "field_id"
  });
  const getOnDelete = (index) => {
    return () => {
      remove(index);
    };
  };
  const getMakeThumbnail = (index) => {
    return () => {
      const newFields = fields.map((field, i) => {
        return {
          ...field,
          isThumbnail: i === index
        };
      });
      form.setValue("media", newFields, {
        shouldDirty: true,
        shouldTouch: true
      });
    };
  };
  const getItemHandlers = (index) => {
    return {
      onDelete: getOnDelete(index),
      onMakeThumbnail: getMakeThumbnail(index)
    };
  };
  return (0, import_jsx_runtime2.jsxs)("div", { id: "media", className: "flex flex-col gap-y-2", children: [
    (0, import_jsx_runtime2.jsx)(UploadMediaFormItem, { form, append, showHint: false }),
    (0, import_jsx_runtime2.jsx)("ul", { className: "flex flex-col gap-y-2", children: fields.map((field, index) => {
      const { onDelete, onMakeThumbnail } = getItemHandlers(index);
      return (0, import_jsx_runtime2.jsx)(
        MediaItem,
        {
          field,
          onDelete,
          onMakeThumbnail
        },
        field.id
      );
    }) })
  ] });
};
var MediaItem = ({ field, onDelete, onMakeThumbnail }) => {
  const { t: t2 } = useTranslation();
  if (!field.file) {
    return null;
  }
  return (0, import_jsx_runtime2.jsxs)("li", { className: "bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2", children: [
    (0, import_jsx_runtime2.jsxs)("div", { className: "flex items-center gap-x-3", children: [
      (0, import_jsx_runtime2.jsx)("div", { className: "bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md", children: (0, import_jsx_runtime2.jsx)(ThumbnailPreview, { file: field.file }) }),
      (0, import_jsx_runtime2.jsxs)("div", { className: "flex flex-col", children: [
        (0, import_jsx_runtime2.jsx)(Text, { size: "small", leading: "compact", children: field.file.name }),
        (0, import_jsx_runtime2.jsxs)("div", { className: "flex items-center gap-x-1", children: [
          field.isThumbnail && (0, import_jsx_runtime2.jsx)(ThumbnailBadge, {}),
          (0, import_jsx_runtime2.jsx)(Text, { size: "xsmall", leading: "compact", className: "text-ui-fg-subtle", children: formatFileSize(field.file.size) })
        ] })
      ] })
    ] }),
    (0, import_jsx_runtime2.jsxs)("div", { className: "flex items-center gap-x-1", children: [
      (0, import_jsx_runtime2.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t2("products.media.makeThumbnail"),
                  icon: (0, import_jsx_runtime2.jsx)(StackPerspective, {}),
                  onClick: onMakeThumbnail
                }
              ]
            },
            {
              actions: [
                {
                  icon: (0, import_jsx_runtime2.jsx)(Trash, {}),
                  label: t2("actions.delete"),
                  onClick: onDelete
                }
              ]
            }
          ]
        }
      ),
      (0, import_jsx_runtime2.jsx)(
        IconButton,
        {
          type: "button",
          size: "small",
          variant: "transparent",
          onClick: onDelete,
          children: (0, import_jsx_runtime2.jsx)(XMark, {})
        }
      )
    ] })
  ] });
};
var ThumbnailPreview = ({ file }) => {
  const [thumbnailUrl, setThumbnailUrl] = (0, import_react2.useState)(null);
  (0, import_react2.useEffect)(() => {
    if (file) {
      const objectUrl = URL.createObjectURL(file);
      setThumbnailUrl(objectUrl);
      return () => URL.revokeObjectURL(objectUrl);
    }
  }, [file]);
  if (!thumbnailUrl) {
    return null;
  }
  return (0, import_jsx_runtime2.jsx)(
    "img",
    {
      src: thumbnailUrl,
      alt: "",
      className: "size-full object-cover object-center"
    }
  );
};
function formatFileSize(bytes, decimalPlaces = 2) {
  if (bytes === 0) {
    return "0 Bytes";
  }
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(decimalPlaces)) + " " + sizes[i];
}
var List = ({
  items,
  onChange,
  renderItem
}) => {
  const [active, setActive] = (0, import_react3.useState)(null);
  const [activeItem, activeIndex] = (0, import_react3.useMemo)(() => {
    if (active === null) {
      return [null, null];
    }
    const index = items.findIndex(({ id }) => id === active.id);
    return [items[index], index];
  }, [active, items]);
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates
    })
  );
  const handleDragStart = ({ active: active2 }) => {
    setActive(active2);
  };
  const handleDragEnd = ({ active: active2, over }) => {
    if (over && active2.id !== over.id) {
      const activeIndex2 = items.findIndex(({ id }) => id === active2.id);
      const overIndex = items.findIndex(({ id }) => id === over.id);
      onChange(arrayMove(items, activeIndex2, overIndex));
    }
    setActive(null);
  };
  const handleDragCancel = () => {
    setActive(null);
  };
  return (0, import_jsx_runtime3.jsxs)(
    DndContext,
    {
      sensors,
      onDragStart: handleDragStart,
      onDragEnd: handleDragEnd,
      onDragCancel: handleDragCancel,
      children: [
        (0, import_jsx_runtime3.jsx)(Overlay, { children: activeItem && activeIndex !== null ? renderItem(activeItem, activeIndex) : null }),
        (0, import_jsx_runtime3.jsx)(SortableContext, { items, children: (0, import_jsx_runtime3.jsx)(
          "ul",
          {
            role: "application",
            className: "flex list-inside list-none list-image-none flex-col p-0",
            children: items.map((item, index) => (0, import_jsx_runtime3.jsx)(import_react3.Fragment, { children: renderItem(item, index) }, item.id))
          }
        ) })
      ]
    }
  );
};
var dropAnimationConfig = {
  sideEffects: defaultDropAnimationSideEffects({
    styles: {
      active: {
        opacity: "0.4"
      }
    }
  })
};
var Overlay = ({ children }) => {
  return (0, import_jsx_runtime3.jsx)(
    DragOverlay,
    {
      className: "shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",
      dropAnimation: dropAnimationConfig,
      children
    }
  );
};
var SortableItemContext = (0, import_react3.createContext)(null);
var useSortableItemContext = () => {
  const context = (0, import_react3.useContext)(SortableItemContext);
  if (!context) {
    throw new Error(
      "useSortableItemContext must be used within a SortableItemContext"
    );
  }
  return context;
};
var Item = ({
  id,
  className,
  children
}) => {
  const {
    attributes,
    isDragging,
    listeners,
    setNodeRef,
    setActivatorNodeRef,
    transform,
    transition
  } = useSortable({ id });
  const context = (0, import_react3.useMemo)(
    () => ({
      attributes,
      listeners,
      ref: setActivatorNodeRef,
      isDragging
    }),
    [attributes, listeners, setActivatorNodeRef, isDragging]
  );
  const style = {
    opacity: isDragging ? 0.4 : void 0,
    transform: CSS.Translate.toString(transform),
    transition
  };
  return (0, import_jsx_runtime3.jsx)(SortableItemContext.Provider, { value: context, children: (0, import_jsx_runtime3.jsx)(
    "li",
    {
      className: clx("transition-fg flex flex-1 list-none", className),
      ref: setNodeRef,
      style,
      children
    }
  ) });
};
var DragHandle = () => {
  const { attributes, listeners, ref } = useSortableItemContext();
  return (0, import_jsx_runtime3.jsx)(
    IconButton,
    {
      variant: "transparent",
      size: "small",
      ...attributes,
      ...listeners,
      ref,
      className: "cursor-grab touch-none active:cursor-grabbing",
      children: (0, import_jsx_runtime3.jsx)(DotsSix, { className: "text-ui-fg-muted" })
    }
  );
};
var SortableList = Object.assign(List, {
  Item,
  DragHandle
});
var getPermutations = (data) => {
  if (data.length === 0) {
    return [];
  }
  if (data.length === 1) {
    return data[0].values.map((value) => ({ [data[0].title]: value }));
  }
  const toProcess = data[0];
  const rest = data.slice(1);
  return toProcess.values.flatMap((value) => {
    return getPermutations(rest).map((permutation) => {
      return {
        [toProcess.title]: value,
        ...permutation
      };
    });
  });
};
var getVariantName = (options) => {
  return Object.values(options).join(" / ");
};
var ProductCreateVariantsSection = ({
  form
}) => {
  var _a, _b, _c;
  const { t: t2 } = useTranslation();
  const options = useFieldArray({
    control: form.control,
    name: "options"
  });
  const variants = useFieldArray({
    control: form.control,
    name: "variants"
  });
  const watchedAreVariantsEnabled = useWatch({
    control: form.control,
    name: "enable_variants",
    defaultValue: false
  });
  const watchedOptions = useWatch({
    control: form.control,
    name: "options",
    defaultValue: []
  });
  const watchedVariants = useWatch({
    control: form.control,
    name: "variants",
    defaultValue: []
  });
  const showInvalidOptionsMessage = !!((_a = form.formState.errors.options) == null ? void 0 : _a.length);
  const showInvalidVariantsMessage = ((_c = (_b = form.formState.errors.variants) == null ? void 0 : _b.root) == null ? void 0 : _c.message) === "invalid_length";
  const handleOptionValueUpdate = (index, value) => {
    const { isTouched: hasUserSelectedVariants } = form.getFieldState("variants");
    const newOptions = [...watchedOptions];
    newOptions[index].values = value;
    const permutations = getPermutations(newOptions);
    const oldVariants = [...watchedVariants];
    const findMatchingPermutation = (options2) => {
      return permutations.find(
        (permutation) => Object.keys(options2).every((key) => options2[key] === permutation[key])
      );
    };
    const newVariants = oldVariants.reduce((variants2, variant) => {
      const match = findMatchingPermutation(variant.options);
      if (match) {
        variants2.push({
          ...variant,
          title: getVariantName(match),
          options: match
        });
      }
      return variants2;
    }, []);
    const usedPermutations = new Set(
      newVariants.map((variant) => variant.options)
    );
    const unusedPermutations = permutations.filter(
      (permutation) => !usedPermutations.has(permutation)
    );
    unusedPermutations.forEach((permutation) => {
      newVariants.push({
        title: getVariantName(permutation),
        options: permutation,
        should_create: hasUserSelectedVariants ? false : true,
        variant_rank: newVariants.length,
        // NOTE - prepare inventory array here for now so we prevent rendering issue if we append the items later
        inventory: [{ inventory_item_id: "", required_quantity: "" }]
      });
    });
    form.setValue("variants", newVariants);
  };
  const handleRemoveOption = (index) => {
    if (index === 0) {
      return;
    }
    options.remove(index);
    const newOptions = [...watchedOptions];
    newOptions.splice(index, 1);
    const permutations = getPermutations(newOptions);
    const oldVariants = [...watchedVariants];
    const findMatchingPermutation = (options2) => {
      return permutations.find(
        (permutation) => Object.keys(options2).every((key) => options2[key] === permutation[key])
      );
    };
    const newVariants = oldVariants.reduce((variants2, variant) => {
      const match = findMatchingPermutation(variant.options);
      if (match) {
        variants2.push({
          ...variant,
          title: getVariantName(match),
          options: match
        });
      }
      return variants2;
    }, []);
    const usedPermutations = new Set(
      newVariants.map((variant) => variant.options)
    );
    const unusedPermutations = permutations.filter(
      (permutation) => !usedPermutations.has(permutation)
    );
    unusedPermutations.forEach((permutation) => {
      newVariants.push({
        title: getVariantName(permutation),
        options: permutation,
        should_create: false,
        variant_rank: newVariants.length
      });
    });
    form.setValue("variants", newVariants);
  };
  const handleRankChange = (items) => {
    const update = items.map((item, index) => {
      const variant = watchedVariants.find((v) => v.title === item.title);
      return {
        id: item.id,
        ...variant || item,
        variant_rank: index
      };
    });
    variants.replace(update);
  };
  const getCheckboxState = (variants2) => {
    if (variants2.every((variant) => variant.should_create)) {
      return true;
    }
    if (variants2.some((variant) => variant.should_create)) {
      return "indeterminate";
    }
    return false;
  };
  const onCheckboxChange = (value) => {
    switch (value) {
      case true: {
        const update = watchedVariants.map((variant) => {
          return {
            ...variant,
            should_create: true
          };
        });
        form.setValue("variants", update);
        break;
      }
      case false: {
        const update = watchedVariants.map((variant) => {
          return {
            ...variant,
            should_create: false
          };
        });
        form.setValue("variants", decorateVariantsWithDefaultValues(update));
        break;
      }
      case "indeterminate":
        break;
    }
  };
  const createDefaultOptionAndVariant = () => {
    form.setValue("options", [
      {
        title: "Default option",
        values: ["Default option value"]
      }
    ]);
    form.setValue(
      "variants",
      decorateVariantsWithDefaultValues([
        {
          title: "Default variant",
          should_create: true,
          variant_rank: 0,
          options: {
            "Default option": "Default option value"
          },
          inventory: [{ inventory_item_id: "", required_quantity: "" }],
          is_default: true
        }
      ])
    );
  };
  return (0, import_jsx_runtime4.jsxs)("div", { id: "variants", className: "flex flex-col gap-y-8", children: [
    (0, import_jsx_runtime4.jsxs)("div", { className: "flex flex-col gap-y-6", children: [
      (0, import_jsx_runtime4.jsx)(Heading, { level: "h2", children: t2("products.create.variants.header") }),
      (0, import_jsx_runtime4.jsx)(
        SwitchBox,
        {
          control: form.control,
          name: "enable_variants",
          label: t2("products.create.variants.subHeadingTitle"),
          description: t2("products.create.variants.subHeadingDescription"),
          onCheckedChange: (checked) => {
            if (checked) {
              form.setValue("options", [
                {
                  title: "",
                  values: []
                }
              ]);
              form.setValue("variants", []);
            } else {
              createDefaultOptionAndVariant();
            }
          }
        }
      )
    ] }),
    watchedAreVariantsEnabled && (0, import_jsx_runtime4.jsxs)(import_jsx_runtime4.Fragment, { children: [
      (0, import_jsx_runtime4.jsx)("div", { className: "flex flex-col gap-y-6", children: (0, import_jsx_runtime4.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "options",
          render: () => {
            return (0, import_jsx_runtime4.jsx)(Form.Item, { children: (0, import_jsx_runtime4.jsxs)("div", { className: "flex flex-col gap-y-6", children: [
              (0, import_jsx_runtime4.jsxs)("div", { className: "flex items-start justify-between gap-x-4", children: [
                (0, import_jsx_runtime4.jsxs)("div", { className: "flex flex-col", children: [
                  (0, import_jsx_runtime4.jsx)(Form.Label, { children: t2("products.create.variants.productOptions.label") }),
                  (0, import_jsx_runtime4.jsx)(Form.Hint, { children: t2("products.create.variants.productOptions.hint") })
                ] }),
                (0, import_jsx_runtime4.jsx)(
                  Button,
                  {
                    size: "small",
                    variant: "secondary",
                    type: "button",
                    onClick: () => {
                      options.append({
                        title: "",
                        values: []
                      });
                    },
                    children: t2("actions.add")
                  }
                )
              ] }),
              showInvalidOptionsMessage && (0, import_jsx_runtime4.jsx)(Alert, { dismissible: true, variant: "error", children: t2("products.create.errors.options") }),
              (0, import_jsx_runtime4.jsx)("ul", { className: "flex flex-col gap-y-4", children: options.fields.map((option, index) => {
                return (0, import_jsx_runtime4.jsxs)(
                  "li",
                  {
                    className: "bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",
                    children: [
                      (0, import_jsx_runtime4.jsxs)("div", { className: "grid grid-cols-[min-content,1fr] items-center gap-1.5", children: [
                        (0, import_jsx_runtime4.jsx)("div", { className: "flex items-center px-2 py-1.5", children: (0, import_jsx_runtime4.jsx)(
                          Label,
                          {
                            size: "xsmall",
                            weight: "plus",
                            className: "text-ui-fg-subtle",
                            htmlFor: `options.${index}.title`,
                            children: t2("fields.title")
                          }
                        ) }),
                        (0, import_jsx_runtime4.jsx)(
                          Input,
                          {
                            className: "bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",
                            ...form.register(
                              `options.${index}.title`
                            ),
                            placeholder: t2(
                              "products.fields.options.optionTitlePlaceholder"
                            )
                          }
                        ),
                        (0, import_jsx_runtime4.jsx)("div", { className: "flex items-center px-2 py-1.5", children: (0, import_jsx_runtime4.jsx)(
                          Label,
                          {
                            size: "xsmall",
                            weight: "plus",
                            className: "text-ui-fg-subtle",
                            htmlFor: `options.${index}.values`,
                            children: t2("fields.values")
                          }
                        ) }),
                        (0, import_jsx_runtime4.jsx)(
                          Controller,
                          {
                            control: form.control,
                            name: `options.${index}.values`,
                            render: ({
                              field: { onChange, ...field }
                            }) => {
                              const handleValueChange = (value) => {
                                handleOptionValueUpdate(index, value);
                                onChange(value);
                              };
                              return (0, import_jsx_runtime4.jsx)(
                                ChipInput,
                                {
                                  ...field,
                                  variant: "contrast",
                                  onChange: handleValueChange,
                                  placeholder: t2(
                                    "products.fields.options.variantionsPlaceholder"
                                  )
                                }
                              );
                            }
                          }
                        )
                      ] }),
                      (0, import_jsx_runtime4.jsx)(
                        IconButton,
                        {
                          type: "button",
                          size: "small",
                          variant: "transparent",
                          className: "text-ui-fg-muted",
                          disabled: index === 0,
                          onClick: () => handleRemoveOption(index),
                          children: (0, import_jsx_runtime4.jsx)(XMarkMini, {})
                        }
                      )
                    ]
                  },
                  option.id
                );
              }) })
            ] }) });
          }
        }
      ) }),
      (0, import_jsx_runtime4.jsx)("div", { className: "grid grid-cols-1 gap-x-4 gap-y-8", children: (0, import_jsx_runtime4.jsxs)("div", { className: "flex flex-col gap-y-6", children: [
        (0, import_jsx_runtime4.jsxs)("div", { className: "flex flex-col", children: [
          (0, import_jsx_runtime4.jsx)(Label, { weight: "plus", children: t2("products.create.variants.productVariants.label") }),
          (0, import_jsx_runtime4.jsx)(Hint, { children: t2("products.create.variants.productVariants.hint") })
        ] }),
        !showInvalidOptionsMessage && showInvalidVariantsMessage && (0, import_jsx_runtime4.jsx)(Alert, { dismissible: true, variant: "error", children: t2("products.create.errors.variants") }),
        variants.fields.length > 0 ? (0, import_jsx_runtime4.jsxs)("div", { className: "overflow-hidden rounded-xl border", children: [
          (0, import_jsx_runtime4.jsxs)(
            "div",
            {
              className: "bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",
              style: {
                gridTemplateColumns: `20px 28px repeat(${watchedOptions.length}, 1fr)`
              },
              children: [
                (0, import_jsx_runtime4.jsx)("div", { children: (0, import_jsx_runtime4.jsx)(
                  Checkbox,
                  {
                    checked: getCheckboxState(watchedVariants),
                    onCheckedChange: onCheckboxChange
                  }
                ) }),
                (0, import_jsx_runtime4.jsx)("div", {}),
                watchedOptions.map((option, index) => (0, import_jsx_runtime4.jsx)("div", { children: (0, import_jsx_runtime4.jsx)(Text, { size: "small", leading: "compact", weight: "plus", children: option.title }) }, index))
              ]
            }
          ),
          (0, import_jsx_runtime4.jsx)(
            SortableList,
            {
              items: variants.fields,
              onChange: handleRankChange,
              renderItem: (item, index) => {
                return (0, import_jsx_runtime4.jsx)(
                  SortableList.Item,
                  {
                    id: item.id,
                    className: clx("bg-ui-bg-base border-b", {
                      "border-b-0": index === variants.fields.length - 1
                    }),
                    children: (0, import_jsx_runtime4.jsxs)(
                      "div",
                      {
                        className: "text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",
                        style: {
                          gridTemplateColumns: `20px 28px repeat(${watchedOptions.length}, 1fr)`
                        },
                        children: [
                          (0, import_jsx_runtime4.jsx)(
                            Form.Field,
                            {
                              control: form.control,
                              name: `variants.${index}.should_create`,
                              render: ({
                                field: { value, onChange, ...field }
                              }) => {
                                return (0, import_jsx_runtime4.jsx)(Form.Item, { children: (0, import_jsx_runtime4.jsx)(Form.Control, { children: (0, import_jsx_runtime4.jsx)(
                                  Checkbox,
                                  {
                                    ...field,
                                    checked: value,
                                    onCheckedChange: onChange
                                  }
                                ) }) });
                              }
                            }
                          ),
                          (0, import_jsx_runtime4.jsx)(SortableList.DragHandle, {}),
                          Object.values(item.options).map((value, index2) => (0, import_jsx_runtime4.jsx)(Text, { size: "small", leading: "compact", children: value }, index2))
                        ]
                      }
                    )
                  }
                );
              }
            }
          )
        ] }) : (0, import_jsx_runtime4.jsx)(Alert, { children: t2("products.create.variants.productVariants.alert") }),
        variants.fields.length > 0 && (0, import_jsx_runtime4.jsx)(InlineTip, { variant: "tip", children: t2("products.create.variants.productVariants.tip") })
      ] }) })
    ] })
  ] });
};
var ProductCreateDetailsForm = ({ form }) => {
  return (0, import_jsx_runtime5.jsx)("div", { className: "flex flex-col items-center p-16", children: (0, import_jsx_runtime5.jsxs)("div", { className: "flex w-full max-w-[720px] flex-col gap-y-8", children: [
    (0, import_jsx_runtime5.jsx)(Header, {}),
    (0, import_jsx_runtime5.jsxs)("div", { className: "flex flex-col gap-y-6", children: [
      (0, import_jsx_runtime5.jsx)(ProductCreateGeneralSection, { form }),
      (0, import_jsx_runtime5.jsx)(ProductCreateMediaSection, { form })
    ] }),
    (0, import_jsx_runtime5.jsx)(Divider, {}),
    (0, import_jsx_runtime5.jsx)(ProductCreateVariantsSection, { form })
  ] }) });
};
var Header = () => {
  const { t: t2 } = useTranslation();
  return (0, import_jsx_runtime5.jsx)("div", { className: "flex flex-col", children: (0, import_jsx_runtime5.jsx)(Heading, { children: t2("products.create.header") }) });
};
function VariantSection({ form, variant, index }) {
  const { t: t2 } = useTranslation();
  const inventory = useFieldArray({
    control: form.control,
    name: `variants.${index}.inventory`
  });
  const inventoryFormData = useWatch({
    control: form.control,
    name: `variants.${index}.inventory`
  });
  const items = useComboboxData({
    queryKey: ["inventory_items"],
    queryFn: (params) => sdk.admin.inventoryItem.list(params),
    getOptions: (data) => data.inventory_items.map((item) => ({
      label: item.title,
      value: item.id
    }))
  });
  const isItemOptionDisabled = (option, inventoryIndex) => {
    return inventoryFormData == null ? void 0 : inventoryFormData.some(
      (i, index2) => index2 != inventoryIndex && i.inventory_item_id === option.value
    );
  };
  return (0, import_jsx_runtime6.jsxs)("div", { className: "grid gap-y-4", children: [
    (0, import_jsx_runtime6.jsxs)("div", { className: "flex items-start justify-between gap-x-4", children: [
      (0, import_jsx_runtime6.jsxs)("div", { className: "flex flex-col", children: [
        (0, import_jsx_runtime6.jsx)(Form.Label, { children: variant.title }),
        (0, import_jsx_runtime6.jsx)(Form.Hint, { children: t2("products.create.inventory.label") })
      ] }),
      (0, import_jsx_runtime6.jsx)(
        Button,
        {
          size: "small",
          variant: "secondary",
          type: "button",
          onClick: () => {
            inventory.append({
              inventory_item_id: "",
              required_quantity: ""
            });
          },
          children: t2("actions.add")
        }
      )
    ] }),
    inventory.fields.map((inventoryItem, inventoryIndex) => (0, import_jsx_runtime6.jsxs)(
      "li",
      {
        className: "bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",
        children: [
          (0, import_jsx_runtime6.jsxs)("div", { className: "grid grid-cols-[min-content,1fr] items-center gap-1.5", children: [
            (0, import_jsx_runtime6.jsx)("div", { className: "flex items-center px-2 py-1.5", children: (0, import_jsx_runtime6.jsx)(
              Label,
              {
                size: "xsmall",
                weight: "plus",
                className: "text-ui-fg-subtle",
                htmlFor: `variants.${index}.inventory.${inventoryIndex}.inventory_item_id`,
                children: t2("fields.item")
              }
            ) }),
            (0, import_jsx_runtime6.jsx)(
              Form.Field,
              {
                control: form.control,
                name: `variants.${index}.inventory.${inventoryIndex}.inventory_item_id`,
                render: ({ field }) => {
                  return (0, import_jsx_runtime6.jsx)(Form.Item, { children: (0, import_jsx_runtime6.jsx)(Form.Control, { children: (0, import_jsx_runtime6.jsx)(
                    Combobox,
                    {
                      ...field,
                      options: items.options.map((o) => ({
                        ...o,
                        disabled: isItemOptionDisabled(o, inventoryIndex)
                      })),
                      searchValue: items.searchValue,
                      onSearchValueChange: items.onSearchValueChange,
                      fetchNextPage: items.fetchNextPage,
                      className: "bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",
                      placeholder: t2(
                        "products.create.inventory.itemPlaceholder"
                      )
                    }
                  ) }) });
                }
              }
            ),
            (0, import_jsx_runtime6.jsx)("div", { className: "flex items-center px-2 py-1.5", children: (0, import_jsx_runtime6.jsx)(
              Label,
              {
                size: "xsmall",
                weight: "plus",
                className: "text-ui-fg-subtle",
                htmlFor: `variants.${index}.inventory.${inventoryIndex}.required_quantity`,
                children: t2("fields.quantity")
              }
            ) }),
            (0, import_jsx_runtime6.jsx)(
              Form.Field,
              {
                control: form.control,
                name: `variants.${index}.inventory.${inventoryIndex}.required_quantity`,
                render: ({ field: { onChange, value, ...field } }) => {
                  return (0, import_jsx_runtime6.jsxs)(Form.Item, { children: [
                    (0, import_jsx_runtime6.jsx)(Form.Control, { children: (0, import_jsx_runtime6.jsx)(
                      Input,
                      {
                        type: "number",
                        className: "bg-ui-bg-field-component",
                        min: 0,
                        value,
                        onChange: (e) => {
                          const value2 = e.target.value;
                          if (value2 === "") {
                            onChange(null);
                          } else {
                            onChange(Number(value2));
                          }
                        },
                        ...field,
                        placeholder: t2(
                          "products.create.inventory.quantityPlaceholder"
                        )
                      }
                    ) }),
                    (0, import_jsx_runtime6.jsx)(Form.ErrorMessage, {})
                  ] });
                }
              }
            )
          ] }),
          (0, import_jsx_runtime6.jsx)(
            IconButton,
            {
              type: "button",
              size: "small",
              variant: "transparent",
              className: "text-ui-fg-muted",
              onClick: () => inventory.remove(inventoryIndex),
              children: (0, import_jsx_runtime6.jsx)(XMarkMini, {})
            }
          )
        ]
      },
      inventoryItem.id
    ))
  ] });
}
var ProductCreateInventoryKitSection = ({
  form
}) => {
  const { t: t2 } = useTranslation();
  const variants = useFieldArray({
    control: form.control,
    name: "variants"
  });
  return (0, import_jsx_runtime6.jsxs)("div", { id: "organize", className: "flex flex-col gap-y-8", children: [
    (0, import_jsx_runtime6.jsx)(Heading, { children: t2("products.create.inventory.heading") }),
    variants.fields.filter((v) => v.inventory_kit).map((variant, variantIndex) => (0, import_jsx_runtime6.jsx)(
      VariantSection,
      {
        form,
        variant,
        index: variantIndex
      },
      variant.id
    ))
  ] });
};
var ProductCreateInventoryKitForm = ({
  form
}) => {
  return (0, import_jsx_runtime7.jsx)("div", { className: "flex flex-col items-center p-16", children: (0, import_jsx_runtime7.jsx)("div", { className: "flex w-full max-w-[720px] flex-col gap-y-8", children: (0, import_jsx_runtime7.jsx)(ProductCreateInventoryKitSection, { form }) }) });
};
var ProductCreateDetailsContext = (0, import_react5.createContext)(null);
var useProductCreateDetailsContext = () => {
  const context = (0, import_react6.useContext)(ProductCreateDetailsContext);
  if (!context) {
    throw new Error(
      "useProductCreateDetailsContext must be used within a ProductCreateDetailsContextProvider"
    );
  }
  return context;
};
var ProductCreateOrganizationSection = ({
  form
}) => {
  const { t: t2 } = useTranslation();
  const { onOpenChange } = useProductCreateDetailsContext();
  const collections = useComboboxData({
    queryKey: ["product_collections"],
    queryFn: (params) => sdk.admin.productCollection.list(params),
    getOptions: (data) => data.collections.map((collection) => ({
      label: collection.title,
      value: collection.id
    }))
  });
  const types = useComboboxData({
    queryKey: ["product_types"],
    queryFn: (params) => sdk.admin.productType.list(params),
    getOptions: (data) => data.product_types.map((type) => ({
      label: type.value,
      value: type.id
    }))
  });
  const tags = useComboboxData({
    queryKey: ["product_tags"],
    queryFn: (params) => sdk.admin.productTag.list(params),
    getOptions: (data) => data.product_tags.map((tag) => ({
      label: tag.value,
      value: tag.id
    }))
  });
  const { fields, remove, replace } = useFieldArray({
    control: form.control,
    name: "sales_channels",
    keyName: "key"
  });
  const handleClearAllSalesChannels = () => {
    replace([]);
  };
  return (0, import_jsx_runtime8.jsxs)("div", { id: "organize", className: "flex flex-col gap-y-8", children: [
    (0, import_jsx_runtime8.jsx)(Heading, { children: t2("products.organization.header") }),
    (0, import_jsx_runtime8.jsx)(
      SwitchBox,
      {
        control: form.control,
        name: "discountable",
        label: t2("products.fields.discountable.label"),
        description: t2("products.fields.discountable.hint"),
        optional: true
      }
    ),
    (0, import_jsx_runtime8.jsxs)("div", { className: "grid grid-cols-1 gap-4 md:grid-cols-2", children: [
      (0, import_jsx_runtime8.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "type_id",
          render: ({ field }) => {
            return (0, import_jsx_runtime8.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime8.jsx)(Form.Label, { optional: true, children: t2("products.fields.type.label") }),
              (0, import_jsx_runtime8.jsx)(Form.Control, { children: (0, import_jsx_runtime8.jsx)(
                Combobox,
                {
                  ...field,
                  options: types.options,
                  searchValue: types.searchValue,
                  onSearchValueChange: types.onSearchValueChange,
                  fetchNextPage: types.fetchNextPage
                }
              ) }),
              (0, import_jsx_runtime8.jsx)(Form.ErrorMessage, {})
            ] });
          }
        }
      ),
      (0, import_jsx_runtime8.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "collection_id",
          render: ({ field }) => {
            return (0, import_jsx_runtime8.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime8.jsx)(Form.Label, { optional: true, children: t2("products.fields.collection.label") }),
              (0, import_jsx_runtime8.jsx)(Form.Control, { children: (0, import_jsx_runtime8.jsx)(
                Combobox,
                {
                  ...field,
                  options: collections.options,
                  searchValue: collections.searchValue,
                  onSearchValueChange: collections.onSearchValueChange,
                  fetchNextPage: collections.fetchNextPage
                }
              ) }),
              (0, import_jsx_runtime8.jsx)(Form.ErrorMessage, {})
            ] });
          }
        }
      )
    ] }),
    (0, import_jsx_runtime8.jsxs)("div", { className: "grid grid-cols-1 gap-4 md:grid-cols-2", children: [
      (0, import_jsx_runtime8.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "categories",
          render: ({ field }) => {
            return (0, import_jsx_runtime8.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime8.jsx)(Form.Label, { optional: true, children: t2("products.fields.categories.label") }),
              (0, import_jsx_runtime8.jsx)(Form.Control, { children: (0, import_jsx_runtime8.jsx)(CategoryCombobox, { ...field }) }),
              (0, import_jsx_runtime8.jsx)(Form.ErrorMessage, {})
            ] });
          }
        }
      ),
      (0, import_jsx_runtime8.jsx)(
        Form.Field,
        {
          control: form.control,
          name: "tags",
          render: ({ field }) => {
            return (0, import_jsx_runtime8.jsxs)(Form.Item, { children: [
              (0, import_jsx_runtime8.jsx)(Form.Label, { optional: true, children: t2("products.fields.tags.label") }),
              (0, import_jsx_runtime8.jsx)(Form.Control, { children: (0, import_jsx_runtime8.jsx)(
                Combobox,
                {
                  ...field,
                  options: tags.options,
                  searchValue: tags.searchValue,
                  onSearchValueChange: tags.onSearchValueChange,
                  fetchNextPage: tags.fetchNextPage
                }
              ) }),
              (0, import_jsx_runtime8.jsx)(Form.ErrorMessage, {})
            ] });
          }
        }
      )
    ] }),
    (0, import_jsx_runtime8.jsx)("div", { className: "grid grid-cols-1 gap-y-4", children: (0, import_jsx_runtime8.jsx)(
      Form.Field,
      {
        control: form.control,
        name: "sales_channels",
        render: () => {
          return (0, import_jsx_runtime8.jsxs)(Form.Item, { children: [
            (0, import_jsx_runtime8.jsxs)("div", { className: "flex items-start justify-between gap-x-4", children: [
              (0, import_jsx_runtime8.jsxs)("div", { children: [
                (0, import_jsx_runtime8.jsx)(Form.Label, { optional: true, children: t2("products.fields.sales_channels.label") }),
                (0, import_jsx_runtime8.jsx)(Form.Hint, { children: (0, import_jsx_runtime8.jsx)(Trans, { i18nKey: "products.fields.sales_channels.hint" }) })
              ] }),
              (0, import_jsx_runtime8.jsx)(
                Button,
                {
                  size: "small",
                  variant: "secondary",
                  type: "button",
                  onClick: () => onOpenChange(true),
                  children: t2("actions.add")
                }
              )
            ] }),
            (0, import_jsx_runtime8.jsx)(Form.Control, { className: "mt-0", children: fields.length > 0 && (0, import_jsx_runtime8.jsx)(
              ChipGroup,
              {
                onClearAll: handleClearAllSalesChannels,
                onRemove: remove,
                className: "py-4",
                children: fields.map((field, index) => (0, import_jsx_runtime8.jsx)(ChipGroup.Chip, { index, children: field.name }, field.key))
              }
            ) })
          ] });
        }
      }
    ) })
  ] });
};
var PAGE_SIZE = 50;
var PREFIX = "sc";
var ProductCreateSalesChannelDrawer = ({
  form
}) => {
  const { t: t2 } = useTranslation();
  const { open, onOpenChange } = useProductCreateDetailsContext();
  const { getValues, setValue } = form;
  const [selection, setSelection] = (0, import_react7.useState)({});
  const [state, setState] = (0, import_react7.useState)([]);
  const { searchParams, raw } = useSalesChannelTableQuery({
    pageSize: PAGE_SIZE,
    prefix: PREFIX
  });
  const { sales_channels, count, isLoading, isError, error } = useSalesChannels(
    {
      ...searchParams
    }
  );
  (0, import_react7.useEffect)(() => {
    if (!open) {
      return;
    }
    const salesChannels = getValues("sales_channels");
    if (salesChannels) {
      setState(
        salesChannels.map((channel) => ({
          id: channel.id,
          name: channel.name
        }))
      );
      setSelection(
        salesChannels.reduce(
          (acc, channel) => ({
            ...acc,
            [channel.id]: true
          }),
          {}
        )
      );
    }
  }, [open, getValues]);
  const updater = (fn) => {
    const value = typeof fn === "function" ? fn(selection) : fn;
    const ids = Object.keys(value);
    const addedIdsSet = new Set(ids.filter((id) => value[id] && !selection[id]));
    let addedSalesChannels = [];
    if (addedIdsSet.size > 0) {
      addedSalesChannels = (sales_channels == null ? void 0 : sales_channels.filter((channel) => addedIdsSet.has(channel.id))) ?? [];
    }
    setState((prev) => {
      const filteredPrev = prev.filter((channel) => value[channel.id]);
      return Array.from(/* @__PURE__ */ new Set([...filteredPrev, ...addedSalesChannels]));
    });
    setSelection(value);
  };
  const handleAdd = () => {
    setValue("sales_channels", state, {
      shouldDirty: true,
      shouldTouch: true
    });
    onOpenChange(false);
  };
  const filters = useSalesChannelTableFilters();
  const columns = useColumns();
  const { table } = useDataTable({
    data: sales_channels ?? [],
    columns,
    count: (sales_channels == null ? void 0 : sales_channels.length) ?? 0,
    enablePagination: true,
    enableRowSelection: true,
    getRowId: (row) => row.id,
    pageSize: PAGE_SIZE,
    rowSelection: {
      state: selection,
      updater
    },
    prefix: PREFIX
  });
  if (isError) {
    throw error;
  }
  return (0, import_jsx_runtime9.jsxs)("div", { className: "flex h-full flex-1 flex-col overflow-hidden", children: [
    (0, import_jsx_runtime9.jsx)("div", { className: "flex-1", children: (0, import_jsx_runtime9.jsx)(
      DataTable,
      {
        table,
        columns,
        pageSize: PAGE_SIZE,
        filters,
        isLoading,
        layout: "fill",
        orderBy: ["name", "created_at", "updated_at"],
        queryObject: raw,
        search: true,
        pagination: true,
        count,
        prefix: PREFIX
      }
    ) }),
    (0, import_jsx_runtime9.jsxs)("div", { className: "flex items-center justify-end gap-x-2 border-t px-6 py-4", children: [
      (0, import_jsx_runtime9.jsx)(SplitView.Close, { asChild: true, children: (0, import_jsx_runtime9.jsx)(Button, { size: "small", variant: "secondary", type: "button", children: t2("actions.cancel") }) }),
      (0, import_jsx_runtime9.jsx)(Button, { size: "small", onClick: handleAdd, type: "button", children: t2("actions.add") })
    ] })
  ] });
};
var columnHelper = createColumnHelper();
var useColumns = () => {
  const base = useSalesChannelTableColumns();
  return (0, import_react7.useMemo)(
    () => [
      columnHelper.display({
        id: "select",
        header: ({ table }) => {
          return (0, import_jsx_runtime9.jsx)(
            Checkbox,
            {
              checked: table.getIsSomePageRowsSelected() ? "indeterminate" : table.getIsAllPageRowsSelected(),
              onCheckedChange: (value) => table.toggleAllPageRowsSelected(!!value)
            }
          );
        },
        cell: ({ row }) => {
          return (0, import_jsx_runtime9.jsx)(
            Checkbox,
            {
              checked: row.getIsSelected(),
              onCheckedChange: (value) => row.toggleSelected(!!value),
              onClick: (e) => {
                e.stopPropagation();
              }
            }
          );
        }
      }),
      ...base
    ],
    [base]
  );
};
var ProductCreateOrganizeForm = ({ form }) => {
  const [open, setOpen] = (0, import_react4.useState)(false);
  return (0, import_jsx_runtime10.jsx)(
    ProductCreateDetailsContext.Provider,
    {
      value: { open, onOpenChange: setOpen },
      children: (0, import_jsx_runtime10.jsxs)(SplitView, { open, onOpenChange: setOpen, children: [
        (0, import_jsx_runtime10.jsx)(SplitView.Content, { children: (0, import_jsx_runtime10.jsx)("div", { className: "flex flex-col items-center p-16", children: (0, import_jsx_runtime10.jsx)("div", { className: "flex w-full max-w-[720px] flex-col gap-y-8", children: (0, import_jsx_runtime10.jsx)(ProductCreateOrganizationSection, { form }) }) }) }),
        (0, import_jsx_runtime10.jsx)(SplitView.Drawer, { children: (0, import_jsx_runtime10.jsx)(ProductCreateSalesChannelDrawer, { form }) })
      ] })
    }
  );
};
var ProductCreateVariantsForm = ({
  form,
  regions,
  store,
  pricePreferences
}) => {
  const { setCloseOnEscape } = useRouteModal();
  const currencyCodes = (0, import_react8.useMemo)(
    () => {
      var _a;
      return ((_a = store == null ? void 0 : store.supported_currencies) == null ? void 0 : _a.map((c) => c.currency_code)) || [];
    },
    [store]
  );
  const variants = useWatch({
    control: form.control,
    name: "variants",
    defaultValue: []
  });
  const options = useWatch({
    control: form.control,
    name: "options",
    defaultValue: []
  });
  const columns = useColumns2({
    options,
    currencies: currencyCodes,
    regions,
    pricePreferences
  });
  const variantData = (0, import_react8.useMemo)(() => {
    const ret = [];
    variants.forEach((v, i) => {
      if (v.should_create) {
        ret.push({ ...v, originalIndex: i });
      }
    });
    return ret;
  }, [variants]);
  return (0, import_jsx_runtime11.jsx)("div", { className: "flex size-full flex-col divide-y overflow-hidden", children: (0, import_jsx_runtime11.jsx)(
    DataGrid,
    {
      columns,
      data: variantData,
      state: form,
      onEditingChange: (editing) => setCloseOnEscape(!editing)
    }
  ) });
};
var columnHelper2 = createDataGridHelper();
var useColumns2 = ({
  options,
  currencies = [],
  regions = [],
  pricePreferences = []
}) => {
  const { t: t2 } = useTranslation();
  return (0, import_react8.useMemo)(
    () => [
      columnHelper2.column({
        id: "options",
        header: () => (0, import_jsx_runtime11.jsx)("div", { className: "flex size-full items-center overflow-hidden", children: (0, import_jsx_runtime11.jsx)("span", { className: "truncate", children: options.map((o) => o.title).join(" / ") }) }),
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(DataGrid.ReadonlyCell, { context, children: options.map((o) => context.row.original.options[o.title]).join(" / ") });
        },
        disableHiding: true
      }),
      columnHelper2.column({
        id: "title",
        name: t2("fields.title"),
        header: t2("fields.title"),
        field: (context) => `variants.${context.row.original.originalIndex}.title`,
        type: "text",
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(DataGrid.TextCell, { context });
        }
      }),
      columnHelper2.column({
        id: "sku",
        name: t2("fields.sku"),
        header: t2("fields.sku"),
        field: (context) => `variants.${context.row.original.originalIndex}.sku`,
        type: "text",
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(DataGrid.TextCell, { context });
        }
      }),
      columnHelper2.column({
        id: "manage_inventory",
        name: t2("fields.managedInventory"),
        header: t2("fields.managedInventory"),
        field: (context) => `variants.${context.row.original.originalIndex}.manage_inventory`,
        type: "boolean",
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(DataGrid.BooleanCell, { context });
        }
      }),
      columnHelper2.column({
        id: "allow_backorder",
        name: t2("fields.allowBackorder"),
        header: t2("fields.allowBackorder"),
        field: (context) => `variants.${context.row.original.originalIndex}.allow_backorder`,
        type: "boolean",
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(DataGrid.BooleanCell, { context });
        }
      }),
      columnHelper2.column({
        id: "inventory_kit",
        name: t2("fields.inventoryKit"),
        header: t2("fields.inventoryKit"),
        field: (context) => `variants.${context.row.original.originalIndex}.inventory_kit`,
        type: "boolean",
        cell: (context) => {
          return (0, import_jsx_runtime11.jsx)(
            DataGrid.BooleanCell,
            {
              context,
              disabled: !context.row.original.manage_inventory
            }
          );
        }
      }),
      ...createDataGridPriceColumns({
        currencies,
        regions,
        pricePreferences,
        getFieldName: (context, value) => {
          var _a;
          if ((_a = context.column.id) == null ? void 0 : _a.startsWith("currency_prices")) {
            return `variants.${context.row.original.originalIndex}.prices.${value}`;
          }
          return `variants.${context.row.original.originalIndex}.prices.${value}`;
        },
        t: t2
      })
    ],
    [currencies, regions, options, pricePreferences, t2]
  );
};
var SAVE_DRAFT_BUTTON = "save-draft-button";
var ProductCreateForm = ({
  defaultChannel,
  regions,
  store,
  pricePreferences
}) => {
  const [tab, setTab] = (0, import_react.useState)(
    "details"
    /* DETAILS */
  );
  const [tabState, setTabState] = (0, import_react.useState)({
    [
      "details"
      /* DETAILS */
    ]: "in-progress",
    [
      "organize"
      /* ORGANIZE */
    ]: "not-started",
    [
      "variants"
      /* VARIANTS */
    ]: "not-started",
    [
      "inventory"
      /* INVENTORY */
    ]: "not-started"
  });
  const { t: t2 } = useTranslation();
  const { handleSuccess } = useRouteModal();
  const form = useForm({
    defaultValues: {
      ...PRODUCT_CREATE_FORM_DEFAULTS,
      sales_channels: defaultChannel ? [{ id: defaultChannel.id, name: defaultChannel.name }] : []
    },
    resolver: t(ProductCreateSchema)
  });
  const { mutateAsync, isPending } = useCreateProduct();
  const regionsCurrencyMap = (0, import_react.useMemo)(() => {
    if (!(regions == null ? void 0 : regions.length)) {
      return {};
    }
    return regions.reduce((acc, reg) => {
      acc[reg.id] = reg.currency_code;
      return acc;
    }, {});
  }, [regions]);
  const watchedVariants = useWatch({
    control: form.control,
    name: "variants"
  });
  const showInventoryTab = (0, import_react.useMemo)(
    () => watchedVariants.some((v) => v.manage_inventory && v.inventory_kit),
    [watchedVariants]
  );
  const handleSubmit = form.handleSubmit(async (values, e) => {
    var _a;
    let isDraftSubmission = false;
    if ((e == null ? void 0 : e.nativeEvent) instanceof SubmitEvent) {
      const submitter = (_a = e == null ? void 0 : e.nativeEvent) == null ? void 0 : _a.submitter;
      isDraftSubmission = submitter.dataset.name === SAVE_DRAFT_BUTTON;
    }
    const media = values.media || [];
    const payload = { ...values, media: void 0 };
    let uploadedMedia = [];
    try {
      if (media.length) {
        const thumbnailReq = media.find((m) => m.isThumbnail);
        const otherMediaReq = media.filter((m) => !m.isThumbnail);
        const fileReqs = [];
        if (thumbnailReq) {
          fileReqs.push(
            sdk.admin.upload.create({ files: [thumbnailReq.file] }).then((r) => r.files.map((f) => ({ ...f, isThumbnail: true })))
          );
        }
        if (otherMediaReq == null ? void 0 : otherMediaReq.length) {
          fileReqs.push(
            sdk.admin.upload.create({
              files: otherMediaReq.map((m) => m.file)
            }).then((r) => r.files.map((f) => ({ ...f, isThumbnail: false })))
          );
        }
        uploadedMedia = (await Promise.all(fileReqs)).flat();
      }
      const { product } = await mutateAsync(
        normalizeProductFormValues({
          ...payload,
          media: uploadedMedia,
          status: isDraftSubmission ? "draft" : "published",
          regionsCurrencyMap
        })
      );
      toast.success(
        t2("products.create.successToast", {
          title: product.title
        })
      );
      handleSuccess(`../${product.id}`);
    } catch (error) {
      if (isFetchError(error) && error.status === 400) {
        toast.error(error.message);
      } else {
        toast.error(t2("general.error"), {
          description: error.message
        });
      }
    }
  });
  const onNext = async (currentTab) => {
    const valid = await form.trigger();
    if (!valid) {
      return;
    }
    if (currentTab === "details") {
      setTab(
        "organize"
        /* ORGANIZE */
      );
    }
    if (currentTab === "organize") {
      setTab(
        "variants"
        /* VARIANTS */
      );
    }
    if (currentTab === "variants") {
      setTab(
        "inventory"
        /* INVENTORY */
      );
    }
  };
  (0, import_react.useEffect)(() => {
    const currentState = { ...tabState };
    if (tab === "details") {
      currentState[
        "details"
        /* DETAILS */
      ] = "in-progress";
    }
    if (tab === "organize") {
      currentState[
        "details"
        /* DETAILS */
      ] = "completed";
      currentState[
        "organize"
        /* ORGANIZE */
      ] = "in-progress";
    }
    if (tab === "variants") {
      currentState[
        "details"
        /* DETAILS */
      ] = "completed";
      currentState[
        "organize"
        /* ORGANIZE */
      ] = "completed";
      currentState[
        "variants"
        /* VARIANTS */
      ] = "in-progress";
    }
    if (tab === "inventory") {
      currentState[
        "details"
        /* DETAILS */
      ] = "completed";
      currentState[
        "organize"
        /* ORGANIZE */
      ] = "completed";
      currentState[
        "variants"
        /* VARIANTS */
      ] = "completed";
      currentState[
        "inventory"
        /* INVENTORY */
      ] = "in-progress";
    }
    setTabState({ ...currentState });
  }, [tab]);
  return (0, import_jsx_runtime12.jsx)(RouteFocusModal, { children: (0, import_jsx_runtime12.jsx)(RouteFocusModal.Form, { form, children: (0, import_jsx_runtime12.jsxs)(
    "form",
    {
      onKeyDown: (e) => {
        if (e.key === "Enter") {
          if (tab !== "variants") {
            e.preventDefault();
            e.stopPropagation();
            onNext(tab);
          }
        }
      },
      onSubmit: handleSubmit,
      className: "flex h-full flex-col",
      children: [
        (0, import_jsx_runtime12.jsxs)(
          ProgressTabs,
          {
            value: tab,
            onValueChange: async (tab2) => {
              const valid = await form.trigger();
              if (!valid) {
                return;
              }
              setTab(tab2);
            },
            className: "flex h-full flex-col overflow-hidden",
            children: [
              (0, import_jsx_runtime12.jsx)(RouteFocusModal.Header, { children: (0, import_jsx_runtime12.jsx)("div", { className: "-my-2 w-full border-l", children: (0, import_jsx_runtime12.jsxs)(ProgressTabs.List, { className: "justify-start-start flex w-full items-center", children: [
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Trigger,
                  {
                    status: tabState[
                      "details"
                      /* DETAILS */
                    ],
                    value: "details",
                    className: "max-w-[200px] truncate",
                    children: t2("products.create.tabs.details")
                  }
                ),
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Trigger,
                  {
                    status: tabState[
                      "organize"
                      /* ORGANIZE */
                    ],
                    value: "organize",
                    className: "max-w-[200px] truncate",
                    children: t2("products.create.tabs.organize")
                  }
                ),
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Trigger,
                  {
                    status: tabState[
                      "variants"
                      /* VARIANTS */
                    ],
                    value: "variants",
                    className: "max-w-[200px] truncate",
                    children: t2("products.create.tabs.variants")
                  }
                ),
                showInventoryTab && (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Trigger,
                  {
                    status: tabState[
                      "inventory"
                      /* INVENTORY */
                    ],
                    value: "inventory",
                    className: "max-w-[200px] truncate",
                    children: t2("products.create.tabs.inventory")
                  }
                )
              ] }) }) }),
              (0, import_jsx_runtime12.jsxs)(RouteFocusModal.Body, { className: "size-full overflow-hidden", children: [
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Content,
                  {
                    className: "size-full overflow-y-auto",
                    value: "details",
                    children: (0, import_jsx_runtime12.jsx)(ProductCreateDetailsForm, { form })
                  }
                ),
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Content,
                  {
                    className: "size-full overflow-y-auto",
                    value: "organize",
                    children: (0, import_jsx_runtime12.jsx)(ProductCreateOrganizeForm, { form })
                  }
                ),
                (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Content,
                  {
                    className: "size-full overflow-y-auto",
                    value: "variants",
                    children: (0, import_jsx_runtime12.jsx)(
                      ProductCreateVariantsForm,
                      {
                        form,
                        store,
                        regions,
                        pricePreferences
                      }
                    )
                  }
                ),
                showInventoryTab && (0, import_jsx_runtime12.jsx)(
                  ProgressTabs.Content,
                  {
                    className: "size-full overflow-y-auto",
                    value: "inventory",
                    children: (0, import_jsx_runtime12.jsx)(ProductCreateInventoryKitForm, { form })
                  }
                )
              ] })
            ]
          }
        ),
        (0, import_jsx_runtime12.jsx)(RouteFocusModal.Footer, { children: (0, import_jsx_runtime12.jsxs)("div", { className: "flex items-center justify-end gap-x-2", children: [
          (0, import_jsx_runtime12.jsx)(RouteFocusModal.Close, { asChild: true, children: (0, import_jsx_runtime12.jsx)(Button, { variant: "secondary", size: "small", children: t2("actions.cancel") }) }),
          (0, import_jsx_runtime12.jsx)(
            Button,
            {
              "data-name": SAVE_DRAFT_BUTTON,
              size: "small",
              type: "submit",
              isLoading: isPending,
              className: "whitespace-nowrap",
              children: t2("actions.saveAsDraft")
            }
          ),
          (0, import_jsx_runtime12.jsx)(
            PrimaryButton,
            {
              tab,
              next: onNext,
              isLoading: isPending,
              showInventoryTab
            }
          )
        ] }) })
      ]
    }
  ) }) });
};
var PrimaryButton = ({
  tab,
  next,
  isLoading,
  showInventoryTab
}) => {
  const { t: t2 } = useTranslation();
  if (tab === "variants" && !showInventoryTab || tab === "inventory" && showInventoryTab) {
    return (0, import_jsx_runtime12.jsx)(
      Button,
      {
        "data-name": "publish-button",
        type: "submit",
        variant: "primary",
        size: "small",
        isLoading,
        children: t2("actions.publish")
      },
      "submit-button"
    );
  }
  return (0, import_jsx_runtime12.jsx)(
    Button,
    {
      type: "button",
      variant: "primary",
      size: "small",
      onClick: () => next(tab),
      children: t2("actions.continue")
    },
    "next-button"
  );
};
var ProductCreate = () => {
  const {
    store,
    isPending: isStorePending,
    isError: isStoreError,
    error: storeError
  } = useStore({
    fields: "default_sales_channel"
  });
  const {
    sales_channel,
    isPending: isSalesChannelPending,
    isError: isSalesChannelError,
    error: salesChannelError
  } = useSalesChannel(store == null ? void 0 : store.default_sales_channel_id, {
    enabled: !!(store == null ? void 0 : store.default_sales_channel_id)
  });
  const {
    regions,
    isPending: isRegionsPending,
    isError: isRegionsError,
    error: regionsError
  } = useRegions({ limit: 9999 });
  const {
    price_preferences,
    isPending: isPricePreferencesPending,
    isError: isPricePreferencesError,
    error: pricePreferencesError
  } = usePricePreferences({
    limit: 9999
  });
  const ready = !!store && !isStorePending && !!regions && !isRegionsPending && !!sales_channel && !isSalesChannelPending && !!price_preferences && !isPricePreferencesPending;
  if (isStoreError) {
    throw storeError;
  }
  if (isRegionsError) {
    throw regionsError;
  }
  if (isSalesChannelError) {
    throw salesChannelError;
  }
  if (isPricePreferencesError) {
    throw pricePreferencesError;
  }
  return (0, import_jsx_runtime13.jsx)(RouteFocusModal, { children: ready && (0, import_jsx_runtime13.jsx)(
    ProductCreateForm,
    {
      defaultChannel: sales_channel,
      store,
      pricePreferences: price_preferences,
      regions
    }
  ) });
};
export {
  ProductCreate as Component
};
//# sourceMappingURL=product-create-ZZF6M52P-JWZZSLLW.js.map
