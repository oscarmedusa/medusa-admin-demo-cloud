import {
  useAcceptInvite
} from "./chunk-QSXBBOKN.js";
import {
  instance
} from "./chunk-ROURSU5C.js";
import "./chunk-4UMAAWOP.js";
import "./chunk-Y5OEN2X7.js";
import {
  AvatarBox
} from "./chunk-WLHYB2NM.js";
import "./chunk-PBA2TK6U.js";
import {
  AnimatePresence,
  motion
} from "./chunk-V6QTDRXV.js";
import {
  t
} from "./chunk-NMISSY3S.js";
import {
  ZodIssueCode,
  numberType,
  objectType,
  stringType
} from "./chunk-D6YTPD33.js";
import {
  Form,
  useForm
} from "./chunk-TKBVWLOU.js";
import {
  isFetchError
} from "./chunk-LGRZWXKE.js";
import {
  useSignUpWithEmailPass
} from "./chunk-2ZDF4QRQ.js";
import "./chunk-QDFILGGU.js";
import "./chunk-ZSXFNTF6.js";
import {
  Alert,
  Button,
  Heading,
  Hint,
  Input,
  Text,
  toast,
  useTranslation
} from "./chunk-ZUPX4YFG.js";
import {
  Link,
  useSearchParams
} from "./chunk-HTGWU6KF.js";
import "./chunk-64MXM5QD.js";
import "./chunk-3VI6QF3M.js";
import {
  require_jsx_runtime
} from "./chunk-P6CFP5BP.js";
import {
  __toESM,
  require_react
} from "./chunk-H5NG3XTT.js";

// node_modules/@medusajs/dashboard/dist/invite-SFHYKYZ2.mjs
var import_react2 = __toESM(require_react(), 1);

// node_modules/react-jwt/dist/index.modern.js
var import_react = __toESM(require_react());
for (n = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", t2 = /* @__PURE__ */ new Map(), o = 0; o < n.length; o++) {
  a = o.toString(2);
  a = "0".repeat(6 - a.length) + a, t2.set(n.charCodeAt(o), a);
}
var a;
var n;
var t2;
var o;
function l(e2) {
  try {
    if ("string" != typeof e2 || 3 !== e2.split(".").length) return null;
    var r2 = function(e3) {
      for (var r3, n = "", t2 = e3.length, o = 0; o < t2; o++) r3 = e3[o], n += String.fromCodePoint(r3 > 251 && r3 < 254 && o + 5 < t2 ? 1073741824 * (r3 - 252) + (e3[++o] - 128 << 24) + (e3[++o] - 128 << 18) + (e3[++o] - 128 << 12) + (e3[++o] - 128 << 6) + e3[++o] - 128 : r3 > 247 && r3 < 252 && o + 4 < t2 ? (r3 - 248 << 24) + (e3[++o] - 128 << 18) + (e3[++o] - 128 << 12) + (e3[++o] - 128 << 6) + e3[++o] - 128 : r3 > 239 && r3 < 248 && o + 3 < t2 ? (r3 - 240 << 18) + (e3[++o] - 128 << 12) + (e3[++o] - 128 << 6) + e3[++o] - 128 : r3 > 223 && r3 < 240 && o + 2 < t2 ? (r3 - 224 << 12) + (e3[++o] - 128 << 6) + e3[++o] - 128 : r3 > 191 && r3 < 224 && o + 1 < t2 ? (r3 - 192 << 6) + e3[++o] - 128 : r3);
      return n;
    }(function(e3) {
      for (var r3 = "", n = 0; n < e3.length; n++) r3 += t2.get(e3.charCodeAt(n));
      r3 = r3.slice(0, r3.length - r3.length % 8);
      for (var o = [], a = 0; a < r3.length / 8; a++) o.push(r3.slice(8 * a, 8 * a + 8));
      return o;
    }(e2.split(".")[1].replaceAll("=", "").replaceAll("-", "+").replaceAll("_", "/")).map(function(e3) {
      return parseInt(e3, 2);
    }));
    return JSON.parse(r2);
  } catch (e3) {
    return console.error("There was an error decoding token: ", e3), null;
  }
}

// node_modules/@medusajs/dashboard/dist/invite-SFHYKYZ2.mjs
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var CreateAccountSchema = objectType({
  email: stringType().email(),
  first_name: stringType().min(1),
  last_name: stringType().min(1),
  password: stringType().min(1),
  repeat_password: stringType().min(1)
}).superRefine(({ password, repeat_password }, ctx) => {
  if (password !== repeat_password) {
    ctx.addIssue({
      code: ZodIssueCode.custom,
      message: instance.t("invite.passwordMismatch"),
      path: ["repeat_password"]
    });
  }
});
var Invite = () => {
  const [searchParams] = useSearchParams();
  const [success, setSuccess] = (0, import_react2.useState)(false);
  const token = searchParams.get("token");
  const invite = token ? l(token) : null;
  const isValidInvite = invite && validateDecodedInvite(invite);
  return (0, import_jsx_runtime.jsx)("div", { className: "bg-ui-bg-subtle relative flex min-h-dvh w-dvw items-center justify-center p-4", children: (0, import_jsx_runtime.jsxs)("div", { className: "flex w-full max-w-[280px] flex-col items-center", children: [
    (0, import_jsx_runtime.jsx)(AvatarBox, { checked: success }),
    (0, import_jsx_runtime.jsx)("div", { className: "max-h-[557px] w-full will-change-contents", children: isValidInvite ? (0, import_jsx_runtime.jsx)(AnimatePresence, { children: !success ? (0, import_jsx_runtime.jsx)(
      motion.div,
      {
        initial: false,
        animate: {
          height: "557px",
          y: 0
        },
        exit: {
          height: 0,
          y: 40
        },
        transition: {
          duration: 0.8,
          delay: 0.6,
          ease: [0, 0.71, 0.2, 1.01]
        },
        className: "w-full will-change-transform",
        children: (0, import_jsx_runtime.jsx)(
          motion.div,
          {
            initial: false,
            animate: {
              opacity: 1,
              scale: 1
            },
            exit: {
              opacity: 0,
              scale: 0.7
            },
            transition: {
              duration: 0.6,
              delay: 0,
              ease: [0, 0.71, 0.2, 1.01]
            },
            children: (0, import_jsx_runtime.jsx)(
              CreateView,
              {
                onSuccess: () => setSuccess(true),
                token,
                invite
              }
            )
          },
          "inner-create-account"
        )
      },
      "create-account"
    ) : (0, import_jsx_runtime.jsx)(
      motion.div,
      {
        initial: {
          opacity: 0,
          scale: 0.4
        },
        animate: {
          opacity: 1,
          scale: 1
        },
        transition: {
          duration: 1,
          delay: 0.6,
          ease: [0, 0.71, 0.2, 1.01]
        },
        className: "w-full",
        children: (0, import_jsx_runtime.jsx)(SuccessView, {})
      },
      "success-view"
    ) }) : (0, import_jsx_runtime.jsx)(InvalidView, {}) })
  ] }) });
};
var LoginLink = () => {
  const { t: t2 } = useTranslation();
  return (0, import_jsx_runtime.jsxs)("div", { className: "flex w-full flex-col items-center", children: [
    (0, import_jsx_runtime.jsx)("div", { className: "my-6 h-px w-full border-b border-dotted" }),
    (0, import_jsx_runtime.jsx)(
      Link,
      {
        to: "/login",
        className: "text-ui-fg-interactive txt-small !text-ui-fg-base font-medium transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover outline-none",
        children: t2("invite.backToLogin")
      },
      "login-link"
    )
  ] });
};
var InvalidView = () => {
  const { t: t2 } = useTranslation();
  return (0, import_jsx_runtime.jsxs)("div", { className: "flex flex-col items-center", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "flex flex-col items-center gap-y-1", children: [
      (0, import_jsx_runtime.jsx)(Heading, { children: t2("invite.invalidTokenTitle") }),
      (0, import_jsx_runtime.jsx)(Text, { size: "small", className: "text-ui-fg-subtle text-center", children: t2("invite.invalidTokenHint") })
    ] }),
    (0, import_jsx_runtime.jsx)(LoginLink, {})
  ] });
};
var CreateView = ({
  onSuccess,
  token,
  invite
}) => {
  var _a, _b, _c, _d, _e, _f;
  const { t: t2 } = useTranslation();
  const [invalid, setInvalid] = (0, import_react2.useState)(false);
  const [params] = useSearchParams();
  const isFirstRun = params.get("first_run") === "true";
  const form = useForm({
    resolver: t(CreateAccountSchema),
    defaultValues: {
      email: isFirstRun ? "" : invite.email || "",
      first_name: "",
      last_name: "",
      password: "",
      repeat_password: ""
    }
  });
  const { mutateAsync: signUpEmailPass, isPending: isCreatingAuthUser } = useSignUpWithEmailPass();
  const { mutateAsync: acceptInvite, isPending: isAcceptingInvite } = useAcceptInvite(token);
  const handleSubmit = form.handleSubmit(async (data) => {
    try {
      const authToken = await signUpEmailPass({
        email: data.email,
        password: data.password
      });
      const invitePayload = {
        email: data.email,
        first_name: data.first_name,
        last_name: data.last_name
      };
      await acceptInvite({
        ...invitePayload,
        auth_token: authToken
      });
      toast.success(t2("invite.toast.accepted"));
      onSuccess();
    } catch (error) {
      if (isFetchError(error) && error.status === 400) {
        form.setError("root", {
          type: "manual",
          message: t2("invite.invalidInvite")
        });
        setInvalid(true);
        return;
      }
      form.setError("root", {
        type: "manual",
        message: t2("errors.serverError")
      });
    }
  });
  const serverError = (_a = form.formState.errors.root) == null ? void 0 : _a.message;
  const validationError = ((_b = form.formState.errors.email) == null ? void 0 : _b.message) || ((_c = form.formState.errors.password) == null ? void 0 : _c.message) || ((_d = form.formState.errors.repeat_password) == null ? void 0 : _d.message) || ((_e = form.formState.errors.first_name) == null ? void 0 : _e.message) || ((_f = form.formState.errors.last_name) == null ? void 0 : _f.message);
  return (0, import_jsx_runtime.jsxs)("div", { className: "flex w-full flex-col items-center", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "mb-4 flex flex-col items-center", children: [
      (0, import_jsx_runtime.jsx)(Heading, { children: t2("invite.title") }),
      (0, import_jsx_runtime.jsx)(Text, { size: "small", className: "text-ui-fg-subtle text-center", children: t2("invite.hint") })
    ] }),
    (0, import_jsx_runtime.jsx)(Form, { ...form, children: (0, import_jsx_runtime.jsxs)("form", { onSubmit: handleSubmit, className: "flex w-full flex-col gap-y-6", children: [
      (0, import_jsx_runtime.jsxs)("div", { className: "flex flex-col gap-y-2", children: [
        (0, import_jsx_runtime.jsx)(
          Form.Field,
          {
            control: form.control,
            name: "email",
            render: ({ field }) => {
              return (0, import_jsx_runtime.jsx)(Form.Item, { children: (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(
                Input,
                {
                  autoComplete: "off",
                  ...field,
                  className: "bg-ui-bg-field-component",
                  placeholder: t2("fields.email")
                }
              ) }) });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          Form.Field,
          {
            control: form.control,
            name: "first_name",
            render: ({ field }) => {
              return (0, import_jsx_runtime.jsx)(Form.Item, { children: (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(
                Input,
                {
                  autoComplete: "given-name",
                  ...field,
                  className: "bg-ui-bg-field-component",
                  placeholder: t2("fields.firstName")
                }
              ) }) });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          Form.Field,
          {
            control: form.control,
            name: "last_name",
            render: ({ field }) => {
              return (0, import_jsx_runtime.jsx)(Form.Item, { children: (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(
                Input,
                {
                  autoComplete: "family-name",
                  ...field,
                  className: "bg-ui-bg-field-component",
                  placeholder: t2("fields.lastName")
                }
              ) }) });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          Form.Field,
          {
            control: form.control,
            name: "password",
            render: ({ field }) => {
              return (0, import_jsx_runtime.jsx)(Form.Item, { children: (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(
                Input,
                {
                  autoComplete: "new-password",
                  type: "password",
                  ...field,
                  className: "bg-ui-bg-field-component",
                  placeholder: t2("fields.password")
                }
              ) }) });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          Form.Field,
          {
            control: form.control,
            name: "repeat_password",
            render: ({ field }) => {
              return (0, import_jsx_runtime.jsx)(Form.Item, { children: (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(
                Input,
                {
                  autoComplete: "off",
                  type: "password",
                  ...field,
                  className: "bg-ui-bg-field-component",
                  placeholder: t2("fields.repeatPassword")
                }
              ) }) });
            }
          }
        ),
        validationError && (0, import_jsx_runtime.jsx)("div", { className: "text-center mt-6", children: (0, import_jsx_runtime.jsx)(Hint, { className: "inline-flex", variant: "error", children: validationError }) }),
        serverError && (0, import_jsx_runtime.jsx)(
          Alert,
          {
            className: "p-2 bg-ui-bg-base items-center",
            dismissible: true,
            variant: "error",
            children: serverError
          }
        )
      ] }),
      (0, import_jsx_runtime.jsx)(
        Button,
        {
          className: "w-full",
          type: "submit",
          isLoading: isCreatingAuthUser || isAcceptingInvite,
          disabled: invalid,
          children: t2("invite.createAccount")
        }
      )
    ] }) }),
    (0, import_jsx_runtime.jsx)(LoginLink, {})
  ] });
};
var SuccessView = () => {
  const { t: t2 } = useTranslation();
  return (0, import_jsx_runtime.jsxs)("div", { className: "flex w-full flex-col items-center gap-y-6", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "flex flex-col items-center gap-y-1", children: [
      (0, import_jsx_runtime.jsx)(Heading, { children: t2("invite.successTitle") }),
      (0, import_jsx_runtime.jsx)(Text, { size: "small", className: "text-ui-fg-subtle text-center", children: t2("invite.successHint") })
    ] }),
    (0, import_jsx_runtime.jsx)(Button, { variant: "secondary", asChild: true, className: "w-full", children: (0, import_jsx_runtime.jsx)(Link, { to: "/login", replace: true, children: t2("invite.successAction") }) }),
    (0, import_jsx_runtime.jsx)(
      Link,
      {
        to: "/login",
        className: "text-ui-fg-interactive txt-small !text-ui-fg-base transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover mt-3 font-medium outline-none",
        children: t2("invite.backToLogin")
      },
      "login-link"
    )
  ] });
};
var InviteSchema = objectType({
  id: stringType(),
  jti: stringType(),
  exp: numberType(),
  iat: numberType()
});
var validateDecodedInvite = (decoded) => {
  return InviteSchema.safeParse(decoded).success;
};
export {
  Invite as Component
};
//# sourceMappingURL=invite-SFHYKYZ2-DU623FSR.js.map
