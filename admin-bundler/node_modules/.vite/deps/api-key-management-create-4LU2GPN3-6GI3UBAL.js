import {
  getApiKeyTypeFromPathname
} from "./chunk-4GAFTK5F.js";
import {
  RouteFocusModal,
  useRouteModal
} from "./chunk-3P6F4Q7W.js";
import {
  useCreateApiKey
} from "./chunk-P5R3EHIV.js";
import "./chunk-ABZDCU5X.js";
import "./chunk-3VJMO5NN.js";
import "./chunk-IH74SCJ5.js";
import "./chunk-4UMAAWOP.js";
import "./chunk-Y5OEN2X7.js";
import {
  t
} from "./chunk-NMISSY3S.js";
import {
  objectType,
  stringType
} from "./chunk-D6YTPD33.js";
import {
  Form,
  useForm
} from "./chunk-TKBVWLOU.js";
import "./chunk-QDFILGGU.js";
import "./chunk-ZSXFNTF6.js";
import {
  Button,
  Eye,
  EyeSlash,
  Heading,
  Input,
  Prompt,
  Text,
  toast,
  useTranslation
} from "./chunk-ZUPX4YFG.js";
import {
  useLocation
} from "./chunk-HTGWU6KF.js";
import "./chunk-64MXM5QD.js";
import "./chunk-3VI6QF3M.js";
import {
  require_jsx_runtime
} from "./chunk-P6CFP5BP.js";
import {
  __toESM,
  require_react
} from "./chunk-H5NG3XTT.js";

// node_modules/@medusajs/dashboard/dist/api-key-management-create-4LU2GPN3.mjs
var import_react = __toESM(require_react(), 1);
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);
var ApiKeyCreateSchema = objectType({
  title: stringType().min(1)
});
function getRedactedKey(key) {
  if (!key) {
    return "";
  }
  const firstThree = key.slice(0, 4);
  const lastTwo = key.slice(-2);
  return `${firstThree}${"â€¢".repeat(key.length - 6)}${lastTwo}`;
}
var ApiKeyCreateForm = ({ keyType }) => {
  const [createdKey, setCreatedKey] = (0, import_react.useState)(null);
  const [showRedactedKey, setShowRedactedKey] = (0, import_react.useState)(true);
  const { t: t2 } = useTranslation();
  const { handleSuccess } = useRouteModal();
  const form = useForm({
    defaultValues: {
      title: ""
    },
    resolver: t(ApiKeyCreateSchema)
  });
  const { mutateAsync, isPending } = useCreateApiKey();
  const handleSubmit = form.handleSubmit(async (values) => {
    await mutateAsync(
      // @ts-ignore
      { title: values.title, type: keyType },
      {
        onSuccess: ({ api_key }) => {
          toast.success(t2("apiKeyManagement.create.successToast"));
          switch (keyType) {
            case "publishable":
              handleSuccess(`/settings/publishable-api-keys/${api_key.id}`);
              break;
            case "secret":
              setCreatedKey(api_key);
              break;
          }
        },
        onError: (err) => {
          toast.error(err.message);
        }
      }
    );
  });
  const handleCopyToken = () => {
    if (!createdKey) {
      toast.error(t2("apiKeyManagement.create.copySecretTokenFailure"));
    }
    navigator.clipboard.writeText((createdKey == null ? void 0 : createdKey.token) ?? "");
    toast.success(t2("apiKeyManagement.create.copySecretTokenSuccess"));
  };
  const handleGoToSecretKey = () => {
    if (!createdKey) {
      return;
    }
    handleSuccess(`/settings/secret-api-keys/${createdKey.id}`);
  };
  return (0, import_jsx_runtime.jsxs)(import_react.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(RouteFocusModal.Form, { form, children: (0, import_jsx_runtime.jsxs)(
      "form",
      {
        className: "flex h-full flex-col overflow-hidden",
        onSubmit: handleSubmit,
        children: [
          (0, import_jsx_runtime.jsx)(RouteFocusModal.Header, { children: (0, import_jsx_runtime.jsxs)("div", { className: "flex items-center justify-end gap-x-2", children: [
            (0, import_jsx_runtime.jsx)(RouteFocusModal.Close, { asChild: true, children: (0, import_jsx_runtime.jsx)(Button, { size: "small", variant: "secondary", children: t2("actions.cancel") }) }),
            (0, import_jsx_runtime.jsx)(Button, { size: "small", type: "submit", isLoading: isPending, children: t2("actions.save") })
          ] }) }),
          (0, import_jsx_runtime.jsx)(RouteFocusModal.Body, { className: "flex flex-1 flex-col overflow-hidden", children: (0, import_jsx_runtime.jsx)("div", { className: "flex flex-1 flex-col items-center overflow-y-auto", children: (0, import_jsx_runtime.jsxs)("div", { className: "flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16", children: [
            (0, import_jsx_runtime.jsxs)("div", { children: [
              (0, import_jsx_runtime.jsx)(Heading, { children: keyType === "publishable" ? t2("apiKeyManagement.create.createPublishableHeader") : t2("apiKeyManagement.create.createSecretHeader") }),
              (0, import_jsx_runtime.jsx)(Text, { size: "small", className: "text-ui-fg-subtle", children: keyType === "publishable" ? t2("apiKeyManagement.create.createPublishableHint") : t2("apiKeyManagement.create.createSecretHint") })
            ] }),
            (0, import_jsx_runtime.jsx)("div", { className: "grid grid-cols-2 gap-4", children: (0, import_jsx_runtime.jsx)(
              Form.Field,
              {
                control: form.control,
                name: "title",
                render: ({ field }) => {
                  return (0, import_jsx_runtime.jsxs)(Form.Item, { children: [
                    (0, import_jsx_runtime.jsx)(Form.Label, { children: t2("fields.title") }),
                    (0, import_jsx_runtime.jsx)(Form.Control, { children: (0, import_jsx_runtime.jsx)(Input, { ...field }) }),
                    (0, import_jsx_runtime.jsx)(Form.ErrorMessage, {})
                  ] });
                }
              }
            ) })
          ] }) }) })
        ]
      }
    ) }),
    (0, import_jsx_runtime.jsx)(Prompt, { variant: "confirmation", open: !!createdKey, children: (0, import_jsx_runtime.jsxs)(Prompt.Content, { className: "w-fit max-w-[42.5%]", children: [
      (0, import_jsx_runtime.jsxs)(Prompt.Header, { children: [
        (0, import_jsx_runtime.jsx)(Prompt.Title, { children: t2("apiKeyManagement.create.secretKeyCreatedHeader") }),
        (0, import_jsx_runtime.jsx)(Prompt.Description, { children: t2("apiKeyManagement.create.secretKeyCreatedHint") })
      ] }),
      (0, import_jsx_runtime.jsxs)("div", { className: "flex flex-col gap-y-3 px-6 py-4", children: [
        (0, import_jsx_runtime.jsxs)("div", { className: "shadow-borders-base bg-ui-bg-component grid h-8 grid-cols-[1fr_32px] items-center overflow-hidden rounded-md", children: [
          (0, import_jsx_runtime.jsx)("div", { className: "flex items-center px-2", children: (0, import_jsx_runtime.jsx)(Text, { family: "mono", size: "small", children: showRedactedKey ? getRedactedKey(createdKey == null ? void 0 : createdKey.token) : createdKey == null ? void 0 : createdKey.token }) }),
          (0, import_jsx_runtime.jsx)(
            "button",
            {
              className: "transition-fg hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed text-ui-fg-muted active:text-ui-fg-subtle flex size-8 appearance-none items-center justify-center border-l",
              type: "button",
              onClick: () => setShowRedactedKey(!showRedactedKey),
              children: showRedactedKey ? (0, import_jsx_runtime.jsx)(EyeSlash, {}) : (0, import_jsx_runtime.jsx)(Eye, {})
            }
          )
        ] }),
        (0, import_jsx_runtime.jsx)(
          Button,
          {
            size: "small",
            variant: "secondary",
            type: "button",
            className: "w-full",
            onClick: handleCopyToken,
            children: t2("apiKeyManagement.actions.copy")
          }
        )
      ] }),
      (0, import_jsx_runtime.jsx)(Prompt.Footer, { className: "border-t py-4", children: (0, import_jsx_runtime.jsx)(Prompt.Action, { onClick: handleGoToSecretKey, children: t2("actions.continue") }) })
    ] }) })
  ] });
};
var ApiKeyManagementCreate = () => {
  const { pathname } = useLocation();
  const keyType = getApiKeyTypeFromPathname(pathname);
  return (0, import_jsx_runtime2.jsx)(RouteFocusModal, { children: (0, import_jsx_runtime2.jsx)(ApiKeyCreateForm, { keyType }) });
};
export {
  ApiKeyManagementCreate as Component
};
//# sourceMappingURL=api-key-management-create-4LU2GPN3-6GI3UBAL.js.map
