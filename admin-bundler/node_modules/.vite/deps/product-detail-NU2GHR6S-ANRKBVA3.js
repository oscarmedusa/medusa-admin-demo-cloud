import {
  TwoColumnPage
} from "./chunk-JYSVBSJS.js";
import {
  getFormattedCountry
} from "./chunk-WZM26QGA.js";
import "./chunk-EGRHWZRV.js";
import {
  SectionRow
} from "./chunk-IWFSKLKK.js";
import "./chunk-GV2TOR46.js";
import "./chunk-EGRHWZRV.js";
import {
  PlaceholderCell
} from "./chunk-QZUCBNNJ.js";
import {
  DataTable,
  useDataTable
} from "./chunk-JH6E7Y6M.js";
import "./chunk-EIGZCZHJ.js";
import "./chunk-CEIAMOT7.js";
import "./chunk-EYAVSJ2J.js";
import {
  createColumnHelper
} from "./chunk-TI6Y7EUW.js";
import {
  useQueryParams
} from "./chunk-JEFCFQ36.js";
import "./chunk-Z74QHE3B.js";
import "./chunk-6VC5CKXS.js";
import "./chunk-4HJQONUH.js";
import "./chunk-IANM7SMM.js";
import {
  productLoader
} from "./chunk-6TGDJN3A.js";
import "./chunk-PCCLBZD7.js";
import {
  PRODUCT_DETAIL_FIELDS
} from "./chunk-L2IFA5EY.js";
import {
  TwoColumnPageSkeleton
} from "./chunk-YSLQHU2M.js";
import {
  ActionMenu
} from "./chunk-IE22HJTV.js";
import "./chunk-RLHQ5IGU.js";
import "./chunk-HZGR4LPF.js";
import "./chunk-3FGSU2DA.js";
import "./chunk-YUBPGLTM.js";
import "./chunk-K4BQKT4B.js";
import "./chunk-SWXOOP7W.js";
import "./chunk-ROURSU5C.js";
import {
  useSalesChannels
} from "./chunk-ABZDCU5X.js";
import {
  useDeleteProduct,
  useDeleteProductOption,
  useDeleteVariant,
  useProduct,
  useProductVariants,
  useUpdateProduct
} from "./chunk-3VJMO5NN.js";
import "./chunk-IH74SCJ5.js";
import "./chunk-4UMAAWOP.js";
import "./chunk-Y5OEN2X7.js";
import "./chunk-QDFILGGU.js";
import {
  keepPreviousData
} from "./chunk-ZSXFNTF6.js";
import {
  Badge,
  Buildings,
  Button,
  Channels,
  Checkbox,
  CommandBar,
  Component,
  Container,
  Heading,
  PencilSquare,
  Plus,
  StatusBadge,
  Text,
  ThumbnailBadge,
  Tooltip,
  Trans,
  Trash,
  clx,
  usePrompt,
  useTranslation
} from "./chunk-ZUPX4YFG.js";
import {
  Link,
  useLoaderData,
  useNavigate,
  useParams
} from "./chunk-HTGWU6KF.js";
import "./chunk-64MXM5QD.js";
import "./chunk-3VI6QF3M.js";
import {
  require_jsx_runtime
} from "./chunk-P6CFP5BP.js";
import {
  __toESM,
  require_react
} from "./chunk-H5NG3XTT.js";

// node_modules/@medusajs/dashboard/dist/product-detail-NU2GHR6S.mjs
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);
var import_react = __toESM(require_react(), 1);
var import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime4 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime5 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime6 = __toESM(require_jsx_runtime(), 1);
var import_react2 = __toESM(require_react(), 1);
var import_jsx_runtime7 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime8 = __toESM(require_jsx_runtime(), 1);
var import_jsx_runtime9 = __toESM(require_jsx_runtime(), 1);
import after from "virtual:medusa/widgets/product/details/after";
import before from "virtual:medusa/widgets/product/details/before";
import sideAfter from "virtual:medusa/widgets/product/details/side/after";
import sideBefore from "virtual:medusa/widgets/product/details/side/before";
var ProductAttributeSection = ({
  product
}) => {
  const { t } = useTranslation();
  return (0, import_jsx_runtime.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime.jsx)(Heading, { level: "h2", children: t("products.attributes") }),
      (0, import_jsx_runtime.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.edit"),
                  to: "attributes",
                  icon: (0, import_jsx_runtime.jsx)(PencilSquare, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.height"), value: product.height }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.width"), value: product.width }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.length"), value: product.length }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.weight"), value: product.weight }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.midCode"), value: product.mid_code }),
    (0, import_jsx_runtime.jsx)(SectionRow, { title: t("fields.hsCode"), value: product.hs_code }),
    (0, import_jsx_runtime.jsx)(
      SectionRow,
      {
        title: t("fields.countryOfOrigin"),
        value: getFormattedCountry(product.origin_country)
      }
    )
  ] });
};
var productStatusColor = (status) => {
  switch (status) {
    case "draft":
      return "grey";
    case "proposed":
      return "orange";
    case "published":
      return "green";
    case "rejected":
      return "red";
    default:
      return "grey";
  }
};
var ProductGeneralSection = ({
  product
}) => {
  const { t } = useTranslation();
  const prompt = usePrompt();
  const navigate = useNavigate();
  const { mutateAsync } = useDeleteProduct(product.id);
  const handleDelete = async () => {
    const res = await prompt({
      title: t("general.areYouSure"),
      description: t("products.deleteWarning", {
        title: product.title
      }),
      confirmText: t("actions.delete"),
      cancelText: t("actions.cancel")
    });
    if (!res) {
      return;
    }
    await mutateAsync(void 0, {
      onSuccess: () => {
        navigate("..");
      }
    });
  };
  return (0, import_jsx_runtime2.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime2.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime2.jsx)(Heading, { children: product.title }),
      (0, import_jsx_runtime2.jsxs)("div", { className: "flex items-center gap-x-4", children: [
        (0, import_jsx_runtime2.jsx)(StatusBadge, { color: productStatusColor(product.status), children: t(`products.productStatus.${product.status}`) }),
        (0, import_jsx_runtime2.jsx)(
          ActionMenu,
          {
            groups: [
              {
                actions: [
                  {
                    label: t("actions.edit"),
                    to: "edit",
                    icon: (0, import_jsx_runtime2.jsx)(PencilSquare, {})
                  }
                ]
              },
              {
                actions: [
                  {
                    label: t("actions.delete"),
                    onClick: handleDelete,
                    icon: (0, import_jsx_runtime2.jsx)(Trash, {})
                  }
                ]
              }
            ]
          }
        )
      ] })
    ] }),
    (0, import_jsx_runtime2.jsx)(SectionRow, { title: t("fields.description"), value: product.description }),
    (0, import_jsx_runtime2.jsx)(SectionRow, { title: t("fields.subtitle"), value: product.subtitle }),
    (0, import_jsx_runtime2.jsx)(SectionRow, { title: t("fields.handle"), value: `/${product.handle}` }),
    (0, import_jsx_runtime2.jsx)(
      SectionRow,
      {
        title: t("fields.discountable"),
        value: product.discountable ? t("fields.true") : t("fields.false")
      }
    )
  ] });
};
var ProductMediaSection = ({ product }) => {
  const { t } = useTranslation();
  const prompt = usePrompt();
  const [selection, setSelection] = (0, import_react.useState)({});
  const media = getMedia(product);
  const handleCheckedChange = (id) => {
    setSelection((prev) => {
      if (prev[id]) {
        const { [id]: _, ...rest } = prev;
        return rest;
      } else {
        return { ...prev, [id]: true };
      }
    });
  };
  const { mutateAsync } = useUpdateProduct(product.id);
  const handleDelete = async () => {
    const ids = Object.keys(selection);
    const includingThumbnail = ids.some(
      (id) => {
        var _a;
        return (_a = media.find((m) => m.id === id)) == null ? void 0 : _a.isThumbnail;
      }
    );
    const res = await prompt({
      title: t("general.areYouSure"),
      description: includingThumbnail ? t("products.media.deleteWarningWithThumbnail", {
        count: ids.length
      }) : t("products.media.deleteWarning", {
        count: ids.length
      }),
      confirmText: t("actions.delete"),
      cancelText: t("actions.cancel")
    });
    if (!res) {
      return;
    }
    const mediaToKeep = product.images.filter((i) => !ids.includes(i.id)).map((i) => ({ url: i.url }));
    await mutateAsync(
      {
        images: mediaToKeep,
        thumbnail: includingThumbnail ? "" : void 0
      },
      {
        onSuccess: () => {
          setSelection({});
        }
      }
    );
  };
  return (0, import_jsx_runtime3.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime3.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime3.jsx)(Heading, { level: "h2", children: t("products.media.label") }),
      (0, import_jsx_runtime3.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.edit"),
                  to: "media?view=edit",
                  icon: (0, import_jsx_runtime3.jsx)(PencilSquare, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    media.length > 0 ? (0, import_jsx_runtime3.jsx)("div", { className: "grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4", children: media.map((i, index) => {
      const isSelected = selection[i.id];
      return (0, import_jsx_runtime3.jsxs)(
        "div",
        {
          className: "shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",
          children: [
            (0, import_jsx_runtime3.jsx)(
              "div",
              {
                className: clx(
                  "transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",
                  {
                    "visible opacity-100": isSelected
                  }
                ),
                children: (0, import_jsx_runtime3.jsx)(
                  Checkbox,
                  {
                    checked: selection[i.id] || false,
                    onCheckedChange: () => handleCheckedChange(i.id)
                  }
                )
              }
            ),
            i.isThumbnail && (0, import_jsx_runtime3.jsx)("div", { className: "absolute left-2 top-2", children: (0, import_jsx_runtime3.jsx)(Tooltip, { content: t("fields.thumbnail"), children: (0, import_jsx_runtime3.jsx)(ThumbnailBadge, {}) }) }),
            (0, import_jsx_runtime3.jsx)(Link, { to: `media`, state: { curr: index }, children: (0, import_jsx_runtime3.jsx)(
              "img",
              {
                src: i.url,
                alt: `${product.title} image`,
                className: "size-full object-cover"
              }
            ) })
          ]
        },
        i.id
      );
    }) }) : (0, import_jsx_runtime3.jsxs)("div", { className: "flex flex-col items-center gap-y-4 pb-8 pt-6", children: [
      (0, import_jsx_runtime3.jsxs)("div", { className: "flex flex-col items-center", children: [
        (0, import_jsx_runtime3.jsx)(
          Text,
          {
            size: "small",
            leading: "compact",
            weight: "plus",
            className: "text-ui-fg-subtle",
            children: t("products.media.emptyState.header")
          }
        ),
        (0, import_jsx_runtime3.jsx)(Text, { size: "small", className: "text-ui-fg-muted", children: t("products.media.emptyState.description") })
      ] }),
      (0, import_jsx_runtime3.jsx)(Button, { size: "small", variant: "secondary", asChild: true, children: (0, import_jsx_runtime3.jsx)(Link, { to: "media?view=edit", children: t("products.media.emptyState.action") }) })
    ] }),
    (0, import_jsx_runtime3.jsx)(CommandBar, { open: !!Object.keys(selection).length, children: (0, import_jsx_runtime3.jsxs)(CommandBar.Bar, { children: [
      (0, import_jsx_runtime3.jsx)(CommandBar.Value, { children: t("general.countSelected", {
        count: Object.keys(selection).length
      }) }),
      (0, import_jsx_runtime3.jsx)(CommandBar.Seperator, {}),
      (0, import_jsx_runtime3.jsx)(
        CommandBar.Command,
        {
          action: handleDelete,
          label: t("actions.delete"),
          shortcut: "d"
        }
      )
    ] }) })
  ] });
};
var getMedia = (product) => {
  const { images = [], thumbnail } = product;
  const media = images.map((image) => ({
    id: image.id,
    url: image.url,
    isThumbnail: image.url === thumbnail
  }));
  if (thumbnail && !media.some((mediaItem) => mediaItem.url === thumbnail)) {
    media.unshift({
      id: "img_thumbnail",
      url: thumbnail,
      isThumbnail: true
    });
  }
  return media;
};
var OptionActions = ({
  product,
  option
}) => {
  const { t } = useTranslation();
  const { mutateAsync } = useDeleteProductOption(product.id, option.id);
  const prompt = usePrompt();
  const handleDelete = async () => {
    const res = await prompt({
      title: t("general.areYouSure"),
      description: t("products.options.deleteWarning", {
        title: option.title
      }),
      confirmText: t("actions.delete"),
      cancelText: t("actions.cancel")
    });
    if (!res) {
      return;
    }
    await mutateAsync();
  };
  return (0, import_jsx_runtime4.jsx)(
    ActionMenu,
    {
      groups: [
        {
          actions: [
            {
              label: t("actions.edit"),
              to: `options/${option.id}/edit`,
              icon: (0, import_jsx_runtime4.jsx)(PencilSquare, {})
            }
          ]
        },
        {
          actions: [
            {
              label: t("actions.delete"),
              onClick: handleDelete,
              icon: (0, import_jsx_runtime4.jsx)(Trash, {})
            }
          ]
        }
      ]
    }
  );
};
var ProductOptionSection = ({
  product
}) => {
  var _a;
  const { t } = useTranslation();
  return (0, import_jsx_runtime4.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime4.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime4.jsx)(Heading, { level: "h2", children: t("products.options.header") }),
      (0, import_jsx_runtime4.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.create"),
                  to: "options/create",
                  icon: (0, import_jsx_runtime4.jsx)(Plus, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    (_a = product.options) == null ? void 0 : _a.map((option) => {
      var _a2;
      return (0, import_jsx_runtime4.jsx)(
        SectionRow,
        {
          title: option.title,
          value: (_a2 = option.values) == null ? void 0 : _a2.map((val) => {
            return (0, import_jsx_runtime4.jsx)(
              Badge,
              {
                size: "2xsmall",
                className: "flex min-w-[20px] items-center justify-center",
                children: val.value
              },
              val.value
            );
          }),
          actions: (0, import_jsx_runtime4.jsx)(OptionActions, { product, option })
        },
        option.id
      );
    })
  ] });
};
var ProductOrganizationSection = ({
  product
}) => {
  var _a, _b;
  const { t } = useTranslation();
  return (0, import_jsx_runtime5.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime5.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime5.jsx)(Heading, { level: "h2", children: t("products.organization.header") }),
      (0, import_jsx_runtime5.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.edit"),
                  to: "organization",
                  icon: (0, import_jsx_runtime5.jsx)(PencilSquare, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    (0, import_jsx_runtime5.jsx)(
      SectionRow,
      {
        title: t("fields.tags"),
        value: ((_a = product.tags) == null ? void 0 : _a.length) ? product.tags.map((tag) => (0, import_jsx_runtime5.jsx)(Badge, { className: "w-fit", size: "2xsmall", asChild: true, children: (0, import_jsx_runtime5.jsx)(Link, { to: `/products?tag_id=${tag.id}`, children: tag.value }) }, tag.id)) : void 0
      }
    ),
    (0, import_jsx_runtime5.jsx)(
      SectionRow,
      {
        title: t("fields.type"),
        value: product.type ? (0, import_jsx_runtime5.jsx)(Badge, { size: "2xsmall", className: "w-fit", asChild: true, children: (0, import_jsx_runtime5.jsx)(Link, { to: `/products?type_id=${product.type_id}`, children: product.type.value }) }) : void 0
      }
    ),
    (0, import_jsx_runtime5.jsx)(
      SectionRow,
      {
        title: t("fields.collection"),
        value: product.collection ? (0, import_jsx_runtime5.jsx)(Badge, { size: "2xsmall", className: "w-fit", asChild: true, children: (0, import_jsx_runtime5.jsx)(Link, { to: `/collections/${product.collection.id}`, children: product.collection.title }) }) : void 0
      }
    ),
    (0, import_jsx_runtime5.jsx)(
      SectionRow,
      {
        title: t("fields.categories"),
        value: ((_b = product.categories) == null ? void 0 : _b.length) ? product.categories.map((pcat) => (0, import_jsx_runtime5.jsx)(Badge, { className: "w-fit", size: "2xsmall", asChild: true, children: (0, import_jsx_runtime5.jsx)(Link, { to: `/categories/${pcat.id}`, children: pcat.name }) }, pcat.id)) : void 0
      }
    )
  ] });
};
var ProductSalesChannelSection = ({
  product
}) => {
  var _a;
  const { count } = useSalesChannels();
  const { t } = useTranslation();
  const availableInSalesChannels = ((_a = product.sales_channels) == null ? void 0 : _a.map((sc) => ({
    id: sc.id,
    name: sc.name
  }))) ?? [];
  const firstChannels = availableInSalesChannels.slice(0, 3);
  const restChannels = availableInSalesChannels.slice(3);
  return (0, import_jsx_runtime6.jsxs)(Container, { className: "flex flex-col gap-y-4 px-6 py-4", children: [
    (0, import_jsx_runtime6.jsxs)("div", { className: "flex items-center justify-between", children: [
      (0, import_jsx_runtime6.jsx)(Heading, { level: "h2", children: t("fields.sales_channels") }),
      (0, import_jsx_runtime6.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.edit"),
                  to: "sales-channels",
                  icon: (0, import_jsx_runtime6.jsx)(PencilSquare, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    (0, import_jsx_runtime6.jsxs)("div", { className: "grid grid-cols-[28px_1fr] items-center gap-x-3", children: [
      (0, import_jsx_runtime6.jsx)("div", { className: "bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md", children: (0, import_jsx_runtime6.jsx)("div", { className: "bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]", children: (0, import_jsx_runtime6.jsx)(Channels, { className: "text-ui-fg-subtle" }) }) }),
      availableInSalesChannels.length > 0 ? (0, import_jsx_runtime6.jsxs)("div", { className: "flex items-center gap-x-1", children: [
        (0, import_jsx_runtime6.jsx)(Text, { size: "small", leading: "compact", children: firstChannels.map((sc) => sc.name).join(", ") }),
        restChannels.length > 0 && (0, import_jsx_runtime6.jsx)(
          Tooltip,
          {
            content: (0, import_jsx_runtime6.jsx)("ul", { children: restChannels.map((sc) => (0, import_jsx_runtime6.jsx)("li", { children: sc.name }, sc.id)) }),
            children: (0, import_jsx_runtime6.jsx)(
              Text,
              {
                size: "small",
                leading: "compact",
                className: "text-ui-fg-subtle",
                children: `+${restChannels.length}`
              }
            )
          }
        )
      ] }) : (0, import_jsx_runtime6.jsx)(Text, { size: "small", leading: "compact", className: "text-ui-fg-subtle", children: t("products.noSalesChannels") })
    ] }),
    (0, import_jsx_runtime6.jsx)("div", { children: (0, import_jsx_runtime6.jsx)(Text, { className: "text-ui-fg-subtle", size: "small", leading: "compact", children: (0, import_jsx_runtime6.jsx)(
      Trans,
      {
        i18nKey: "sales_channels.availableIn",
        values: {
          x: availableInSalesChannels.length,
          y: count ?? 0
        },
        components: [
          (0, import_jsx_runtime6.jsx)(
            "span",
            {
              className: "text-ui-fg-base txt-compact-medium-plus"
            },
            "x"
          ),
          (0, import_jsx_runtime6.jsx)(
            "span",
            {
              className: "text-ui-fg-base txt-compact-medium-plus"
            },
            "y"
          )
        ]
      }
    ) }) })
  ] });
};
var VariantActions = ({
  variant,
  product
}) => {
  var _a;
  const { mutateAsync } = useDeleteVariant(product.id, variant.id);
  const { t } = useTranslation();
  const prompt = usePrompt();
  const inventoryItemsCount = ((_a = variant.inventory_items) == null ? void 0 : _a.length) || 0;
  const hasInventoryItem = inventoryItemsCount === 1;
  const hasInventoryKit = inventoryItemsCount > 1;
  const handleDelete = async () => {
    const res = await prompt({
      title: t("general.areYouSure"),
      description: t("products.deleteVariantWarning", {
        title: variant.title
      }),
      confirmText: t("actions.delete"),
      cancelText: t("actions.cancel")
    });
    if (!res) {
      return;
    }
    await mutateAsync();
  };
  const [inventoryItemLink, inventoryKitLink] = (0, import_react2.useMemo)(() => {
    var _a2;
    if (!((_a2 = variant.inventory_items) == null ? void 0 : _a2.length)) {
      return ["", ""];
    }
    const itemId = variant.inventory_items[0].inventory.id;
    const itemLink = `/inventory/${itemId}`;
    const itemIds = variant.inventory_items.map((i) => i.inventory.id);
    const params = { id: itemIds };
    const query = new URLSearchParams(params).toString();
    const kitLink = `/inventory?${query}`;
    return [itemLink, kitLink];
  }, [variant.inventory_items]);
  return (0, import_jsx_runtime7.jsx)(
    ActionMenu,
    {
      groups: [
        {
          actions: [
            {
              label: t("actions.edit"),
              to: `edit-variant?variant_id=${variant.id}`,
              icon: (0, import_jsx_runtime7.jsx)(PencilSquare, {})
            },
            {
              label: t("actions.delete"),
              onClick: handleDelete,
              icon: (0, import_jsx_runtime7.jsx)(Trash, {})
            },
            hasInventoryItem ? {
              label: t("products.variant.inventory.actions.inventoryItems"),
              to: inventoryItemLink,
              icon: (0, import_jsx_runtime7.jsx)(Buildings, {})
            } : false,
            hasInventoryKit ? {
              label: t("products.variant.inventory.actions.inventoryKit"),
              to: inventoryKitLink,
              icon: (0, import_jsx_runtime7.jsx)(Component, {})
            } : false
          ].filter(Boolean)
        }
      ]
    }
  );
};
var columnHelper = createColumnHelper();
var useProductVariantTableColumns = (product) => {
  const { t } = useTranslation();
  const optionColumns = (0, import_react2.useMemo)(() => {
    var _a;
    if (!product) {
      return [];
    }
    return (_a = product.options) == null ? void 0 : _a.map((option) => {
      return columnHelper.display({
        id: option.id,
        header: () => (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: option.title }) }),
        cell: ({ row }) => {
          const variantOpt = row.original.options.find(
            (opt) => opt.option_id === option.id
          );
          if (!variantOpt) {
            return (0, import_jsx_runtime7.jsx)(PlaceholderCell, {});
          }
          return (0, import_jsx_runtime7.jsx)("div", { className: "flex items-center", children: (0, import_jsx_runtime7.jsx)(
            Badge,
            {
              size: "2xsmall",
              title: variantOpt.value,
              className: "inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",
              children: variantOpt.value
            }
          ) });
        }
      });
    });
  }, [product]);
  return (0, import_react2.useMemo)(
    () => [
      columnHelper.accessor("title", {
        header: () => (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: t("fields.title") }) }),
        cell: ({ getValue }) => (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center overflow-hidden", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: getValue() }) })
      }),
      columnHelper.accessor("sku", {
        header: () => (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: t("fields.sku") }) }),
        cell: ({ getValue }) => {
          const value = getValue();
          if (!value) {
            return (0, import_jsx_runtime7.jsx)(PlaceholderCell, {});
          }
          return (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center overflow-hidden", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: value }) });
        }
      }),
      ...optionColumns,
      columnHelper.accessor("inventory_items", {
        header: () => (0, import_jsx_runtime7.jsx)("div", { className: "flex h-full w-full items-center", children: (0, import_jsx_runtime7.jsx)("span", { className: "truncate", children: t("fields.inventory") }) }),
        cell: ({ getValue, row }) => {
          const variant = row.original;
          if (!variant.manage_inventory) {
            return t("products.variant.inventory.notManaged");
          }
          const inventory = getValue().map(
            (i) => i.inventory
          );
          const hasInventoryKit = inventory.length > 1;
          const locations = {};
          inventory.forEach((i) => {
            i.location_levels.forEach((l) => {
              locations[l.id] = true;
            });
          });
          const locationCount = Object.keys(locations).length;
          const text = hasInventoryKit ? t("products.variant.tableItemAvailable", {
            availableCount: variant.inventory_quantity
          }) : t("products.variant.tableItem", {
            availableCount: variant.inventory_quantity,
            locationCount,
            count: locationCount
          });
          return (0, import_jsx_runtime7.jsxs)("div", { className: "flex h-full w-full items-center gap-2 overflow-hidden", children: [
            hasInventoryKit && (0, import_jsx_runtime7.jsx)(Component, { style: { marginTop: 1 } }),
            (0, import_jsx_runtime7.jsx)(
              "span",
              {
                className: clx("truncate", {
                  "text-ui-fg-error": !variant.inventory_quantity
                }),
                title: text,
                children: text
              }
            )
          ] });
        }
      }),
      columnHelper.display({
        id: "actions",
        cell: ({ row, table }) => {
          const { product: product2 } = table.options.meta;
          return (0, import_jsx_runtime7.jsx)(VariantActions, { variant: row.original, product: product2 });
        }
      })
    ],
    [t, optionColumns]
  );
};
var useProductVariantTableFilters = () => {
  const { t } = useTranslation();
  let filters = [];
  const manageInventoryFilter = {
    key: "manage_inventory",
    label: t("fields.managedInventory"),
    type: "select",
    options: [
      {
        label: t("fields.true"),
        value: "true"
      },
      {
        label: t("fields.false"),
        value: "false"
      }
    ]
  };
  const allowBackorderFilter = {
    key: "allow_backorder",
    label: t("fields.allowBackorder"),
    type: "select",
    options: [
      {
        label: t("fields.true"),
        value: "true"
      },
      {
        label: t("fields.false"),
        value: "false"
      }
    ]
  };
  const dateFilters = [
    { label: t("fields.createdAt"), key: "created_at" },
    { label: t("fields.updatedAt"), key: "updated_at" }
  ].map((f) => ({
    key: f.key,
    label: f.label,
    type: "date"
  }));
  filters = [
    ...filters,
    manageInventoryFilter,
    allowBackorderFilter,
    ...dateFilters
  ];
  return filters;
};
var useProductVariantTableQuery = ({
  pageSize,
  prefix
}) => {
  const queryObject = useQueryParams(
    [
      "offset",
      "q",
      "manage_inventory",
      "allow_backorder",
      "order",
      "created_at",
      "updated_at"
    ],
    prefix
  );
  const {
    offset,
    manage_inventory,
    allow_backorder,
    created_at,
    updated_at,
    q,
    order
  } = queryObject;
  const searchParams = {
    limit: pageSize,
    offset: offset ? Number(offset) : 0,
    manage_inventory: manage_inventory ? manage_inventory === "true" : void 0,
    allow_backorder: allow_backorder ? allow_backorder === "true" : void 0,
    order,
    created_at: created_at ? JSON.parse(created_at) : void 0,
    updated_at: updated_at ? JSON.parse(updated_at) : void 0,
    q
  };
  return {
    searchParams,
    raw: queryObject
  };
};
var PAGE_SIZE = 10;
var ProductVariantSection = ({
  product
}) => {
  const { t } = useTranslation();
  const { searchParams, raw } = useProductVariantTableQuery({
    pageSize: PAGE_SIZE
  });
  const { variants, count, isLoading, isError, error } = useProductVariants(
    product.id,
    {
      ...searchParams,
      fields: "*inventory_items.inventory.location_levels,+inventory_quantity"
    },
    {
      placeholderData: keepPreviousData
    }
  );
  const filters = useProductVariantTableFilters();
  const columns = useProductVariantTableColumns(product);
  const { table } = useDataTable({
    data: variants ?? [],
    columns,
    count,
    enablePagination: true,
    getRowId: (row) => row.id,
    pageSize: PAGE_SIZE,
    meta: {
      product
    }
  });
  if (isError) {
    throw error;
  }
  return (0, import_jsx_runtime8.jsxs)(Container, { className: "divide-y p-0", children: [
    (0, import_jsx_runtime8.jsxs)("div", { className: "flex items-center justify-between px-6 py-4", children: [
      (0, import_jsx_runtime8.jsx)(Heading, { level: "h2", children: t("products.variants") }),
      (0, import_jsx_runtime8.jsx)(
        ActionMenu,
        {
          groups: [
            {
              actions: [
                {
                  label: t("actions.create"),
                  to: `variants/create`,
                  icon: (0, import_jsx_runtime8.jsx)(Plus, {})
                },
                {
                  label: t("products.editPrices"),
                  to: `prices`,
                  icon: (0, import_jsx_runtime8.jsx)(PencilSquare, {})
                }
              ]
            }
          ]
        }
      )
    ] }),
    (0, import_jsx_runtime8.jsx)(
      DataTable,
      {
        table,
        columns,
        filters,
        count,
        pageSize: PAGE_SIZE,
        isLoading,
        orderBy: ["title", "created_at", "updated_at"],
        navigateTo: (row) => `/products/${row.original.product_id}/variants/${row.id}`,
        pagination: true,
        search: true,
        queryObject: raw
      }
    )
  ] });
};
var ProductDetail = () => {
  const initialData = useLoaderData();
  const { id } = useParams();
  const { product, isLoading, isError, error } = useProduct(
    id,
    { fields: PRODUCT_DETAIL_FIELDS },
    {
      initialData
    }
  );
  if (isLoading || !product) {
    return (0, import_jsx_runtime9.jsx)(
      TwoColumnPageSkeleton,
      {
        mainSections: 4,
        sidebarSections: 3,
        showJSON: true,
        showMetadata: true
      }
    );
  }
  if (isError) {
    throw error;
  }
  return (0, import_jsx_runtime9.jsxs)(
    TwoColumnPage,
    {
      widgets: {
        after,
        before,
        sideAfter,
        sideBefore
      },
      showJSON: true,
      showMetadata: true,
      data: product,
      children: [
        (0, import_jsx_runtime9.jsxs)(TwoColumnPage.Main, { children: [
          (0, import_jsx_runtime9.jsx)(ProductGeneralSection, { product }),
          (0, import_jsx_runtime9.jsx)(ProductMediaSection, { product }),
          (0, import_jsx_runtime9.jsx)(ProductOptionSection, { product }),
          (0, import_jsx_runtime9.jsx)(ProductVariantSection, { product })
        ] }),
        (0, import_jsx_runtime9.jsxs)(TwoColumnPage.Sidebar, { children: [
          (0, import_jsx_runtime9.jsx)(ProductSalesChannelSection, { product }),
          (0, import_jsx_runtime9.jsx)(ProductOrganizationSection, { product }),
          (0, import_jsx_runtime9.jsx)(ProductAttributeSection, { product })
        ] })
      ]
    }
  );
};
export {
  ProductDetail as Component,
  productLoader as loader
};
//# sourceMappingURL=product-detail-NU2GHR6S-ANRKBVA3.js.map
